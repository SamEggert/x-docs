---
title: Prise en main
sidebarTitle: Prise en main
---

import { Button } from '/snippets/fr/button.mdx';

<div id="getting-started-with-the-manage-direct-message-endpoints">
  ## Prise en main des endpoints de gestion des Messages privés
</div>

Ce guide de démarrage rapide vous aidera à effectuer votre première requête vers les endpoints de Messages privés avec Postman, un outil pour gérer et exécuter des requêtes HTTP. Pour en savoir plus sur nos collections Postman, consultez notre guide [Utiliser Postman](/fr/tutorials/postman-getting-started).

Consultez notre dépôt GitHub [Exemples de code X API v2](https://github.com/xdevplatform/Twitter-API-v2-sample-code) si vous souhaitez examiner des exemples en Python. Par ailleurs, les [kits de développement logiciel (SDK) officiels de la plateforme développeur X](/fr/x-api/tools-and-libraries/sdks) seront mis à jour pour prendre en charge ces endpoints de Messages privés.  

<Note>
  **Prérequis**

  Pour suivre ce guide, vous aurez besoin d’un ensemble de [clés et jetons](/fr/resources/fundamentals/authentication) pour authentifier votre requête. Vous pouvez générer ces clés et jetons en suivant ces étapes :

  * [Inscrivez-vous pour un compte développeur](https://developer.x.com/en/apply-for-access) et attendez l’approbation.
  * Créez un [Project](/fr/resources/fundamentals/projects) et une [developer App](/fr/resources/fundamentals/developer-apps) associés dans le portail développeur.
  * Accédez à la page « Keys and tokens » de votre App pour générer les identifiants requis. Veillez à enregistrer tous les identifiants dans un emplacement sécurisé.
</Note>

<div id="steps-to-building-direct-message-lookup-requests">
  ### Étapes pour créer des requêtes de recherche de Messages privés
</div>

Dans cet exemple, en une seule requête, nous allons créer une nouvelle conversation de groupe et y ajouter un premier message. Nous ajouterons ensuite un deuxième message à la conversation créée.

<div id="step-one-start-with-a-tool-or-library">
  #### Première étape : commencer avec un outil ou une bibliothèque
</div>

Pour commencer à utiliser les endpoints de gestion des Messages privés, nous allons recourir à l’outil Postman afin de simplifier le processus. Une collection d’exemples de requêtes X API v2, rédigée par XDevelopers, servira à explorer six endpoints permettant de créer de nouveaux Messages privés et de lister les événements des conversations de Messages privés.

Bien que la plupart de la collection soit préremplie, vous devrez fournir quelques informations liées à l’application X créée pour héberger ces requêtes API. Commençons par charger/mettre à jour la collection.

Pour charger la collection X API v2 dans votre environnement Postman, veuillez cliquer sur le bouton suivant :

<Button href="https://app.getpostman.com/run-collection/9956214-784efcda-ed4c-4491-a4c0-a26470a67400">
  Ajouter X API v2 à Postman
</Button>

Une fois la collection X API v2 chargée dans Postman, accédez au dossier “Manage Direct Messages”. L’onglet Authorization de ce dossier a été prérempli lorsque c’était possible. Vous devrez mettre à jour quelques paramètres pour renseigner les informations d’authentification de votre application X.

Ce dossier contient également trois endpoints pour créer de nouveaux Messages privés. Notez qu’il existe aussi un dossier &quot;Direct Message lookup&quot; avec trois endpoints permettant de récupérer les événements des conversations de Messages privés, notamment l’envoi et la réception de messages, ainsi que l’arrivée et le départ des participants.

La création de conversations de groupe étant une nouvelle fonctionnalité de X API v2, cet exemple se concentrera sur ce cas. Nous utiliserons l’exemple &quot;New group DM and conversation&quot;. Cette requête nous permettra de créer une conversation de groupe en Message privé.

L’étape suivante consiste à s’authentifier auprès de l’endpoint.

<div id="step-two-authenticate-your-request">
  #### Deuxième étape : Authentifiez votre requête
</div>

Pour envoyer correctement une requête à l’API X, vous devez vérifier que vous avez l’autorisation de le faire. Pour effectuer une requête réussie vers cet endpoint, nous utiliserons l’[OAuth 2.0 Authorization Code Flow with PKCE](fr/resources/fundamentals/authentication#oauth-2-0-authorization-code-flow-with-pkce-2). Vous pouvez générer un jeton d’accès dans Postman. 

Avec Postman, vous pouvez définir la méthode d’authentification au niveau du dossier ou de la requête. Ici, nous allons configurer les paramètres d’authentification au niveau du dossier. Accédez au dossier &quot;Manage Direct Messages&quot;, sélectionnez l’onglet &quot;Authorization&quot; et confirmez que le Type est défini sur &quot;OAuth 2.0&quot;, et que &quot;Add auth data to&quot; est défini sur &quot;Request Headers&quot;. Dans la section &quot;Current Token&quot;, assurez-vous que le &quot;Header Prefix&quot; est défini sur &quot;Bearer&quot;.  

Pour configurer et générer un nouveau jeton :

1. Créez un nom de jeton, par exemple &quot;DM lookup&quot;.

2. Confirmez que **Grant Type** est défini sur &quot;Authorization Code (with PKCE)&quot;.

3. Définissez votre **Callback URL**. Vous devez mettre à jour votre Callback URL pour qu’elle corresponde exactement à l’URL de rappel associée à votre application dans le [v2 Dev Portal](https://developer.x.com/en/portal/dashboard). Avec l’application X utilisée dans cet exemple, la Callback URL est définie sur [https://www.example.com](https://www.example.com/) (notez que, comme cela doit correspondre exactement, [https://example.com](https://example.com) ne fonctionnerait pas). 

4. Confirmez que **Auth URL** est défini sur [https://x.com/i/oauth2/authorize](https://x.com/i/oauth2/authorize).

5. Confirmez que **Access Token URL** est défini sur [https://api.x.com/2/oauth2/token](https://api.x.com/2/oauth2/token).\
   **Client ID** : copiez-collez l’identifiant client OAuth 2.0 depuis le Developer Portal.\
   **Client Secret** : vous n’en aurez besoin que si vous utilisez un type d’application « confidential client ». Le cas échéant, copiez-collez le Client Secret OAuth 2.0 depuis le Developer Portal. 

6. Confirmez que **Scope** est défini sur dm.read dm.write tweet.read users.read.

7. Confirmez que **State** est défini sur &quot;state&quot;.

8. Confirmez que **Client Authentication** est défini sur &quot;Send as Basic Auth header&quot;.

9. Cliquez sur &quot;Get New Access Token&quot;, puis cliquez sur &quot;Authorize app&quot; dans le cadre du processus &quot;Sign in with X&quot;.

10. Cliquez sur le bouton &quot;Proceed&quot;, puis sur &quot;Use Token&quot; pour générer un jeton. 

11. Cliquez sur le bouton &quot;Save&quot; pour enregistrer ces paramètres de configuration.

Vous pouvez recevoir un message indiquant que vous n’êtes pas connecté à X. Si vous obtenez cette erreur, vous devrez vous connecter, dans Postman, au compte X pour le compte duquel vous essayez de publier.

Maintenant que ces paramètres OAuth 2.0 ont été définis au niveau du dossier, accédez à chacun des exemples, puis à leur onglet &quot;Authorization&quot;, et confirmez que leur Type est défini sur &quot;Inherit auth from parent&quot;. 

Notez que ce jeton expirera bientôt et que vous devrez le régénérer en cliquant sur le bouton &quot;Get New Access Token&quot;. Cela déclenchera le processus &quot;Sign in with X&quot; et générera un nouveau jeton pour effectuer des requêtes.

<div id="step-three-retrieve-direct-messages-conversation-events">
  #### Étape trois : Récupérer les événements de conversation des Messages privés
</div>

Pour récupérer les événements de conversation des Messages privés avec cet endpoint, vous devez spécifier un ID de conversation. L’ID de conversation fait partie du chemin de l’endpoint : https://api.x.com/2/dm&#95;conversations/:dm&#95;conversation&#95;id/dm&#95;events

Dans Postman, allez à l’onglet « Params » et saisissez l’ID de la conversation pour laquelle vous souhaitez récupérer des événements dans la section « Path Variables ».

Le paramétrage est le suivant :

|     |     |
| :--- | :--- |
| **Key** | **Value** |
| `dm_conversation_id` | `1228393702244134912` |

Avec cette conversation spécifiée, le chemin résultant devient https://api.x.com/2/dm&#95;conversations/1582103724607971328/dm&#95;events

Si vous cliquez sur le bouton « Send », vous recevrez, dans la réponse, les champs par défaut de l’objet Message privé : id, text et event&#95;type. Il y aura également un objet « meta » indiquant le nombre de résultats, ainsi que des jetons de pagination pour récupérer d’autres événements si disponibles.

```
{
   "data": [
       {
           "event_type": "MessageCreate",
           "id": "1580705921830768647",
           "text": "hello to you two, this is a new group conversation."
       }
   ],
   "meta": {
       "result_count": 1,
       "next_token": "18LAA5FFPEKJA52G0G00ZZZZ",
       "previous_token": "1BLC45FFPEKJA52G0S00ZZZZ"
   }
}
```

Si vous souhaitez recevoir des champs supplémentaires, vous devez les spécifier dans votre requête avec les paramètres [field](/fr/x-api/fundamentals/fields) et/ou [expansion](/fr/x-api/fundamentals/expansions).

Pour cet exercice, nous allons demander des ensembles supplémentaires de champs de l’objet dm&#95;event :

1. Les champs par défaut de l’objet Message privé : id, text et event&#95;type.

2. Des champs supplémentaires de l’objet Message privé : dm&#95;conversation&#95;id, created&#95;at, sender&#95;id, attachments, participant&#95;ids, referenced&#95;tweets

Dans Postman, allez à l’onglet « Params » et ajoutez la paire clé:valeur suivante au tableau « Query Params » :

|     |     |
| :--- | :--- |
| Key | Value |
| dm&#95;event.fields | dm&#95;conversation&#95;id,created&#95;at,sender&#95;id,attachments,participant&#95;ids,referenced&#95;tweets |

Vous devriez maintenant voir l’URL suivante à côté du bouton « Send » :

https://api.x.com/2/dm&#95;conversations/:dm&#95;conversation&#95;id/dm&#95;events?dm&#95;event.fields=id,text,event&#95;type,dm&#95;conversation&#95;id,created&#95;at,sender&#95;id,attachments,participant&#95;ids,referenced&#95;tweets

<div id="step-four-make-your-request-and-review-your-response">
  #### Quatrième étape : envoyez votre requête et examinez la réponse
</div>

Une fois tout configuré, cliquez de nouveau sur le bouton « Send », et vous recevrez une réponse similaire à celle ci-dessous. Notez que cette réponse inclut tous les champs dm&#95;event disponibles.

```
{
   "data": [
       {
           "text": "hello to you two, this is a new group conversation.",
           "id": "1580705921830768647",
           "dm_conversation_id": "1580705921830768643",
           "event_type": "MessageCreate",
           "sender_id": "17200003",
           "created_at": "2022-10-13T23:43:54.000Z"
       }
   ],
   "meta": {
       "result_count": 1,
       "next_token": "18LAA5FFPEKJA52G0G00ZZZZ",
       "previous_token": "1BLC45FFPEKJA52G0S00ZZZZ"
   }
}
```