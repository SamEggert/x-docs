Dans ce guide, nous vous montrerons comment utiliser les nouveaux endpoints Community Notes avec Python.

Pour utiliser les endpoints Community Notes, assurez-vous de disposer d‚Äôun [compte X Developers valide](https://developer.x.com/) et d‚Äô√™tre inscrit en tant que [Community Notes AI Note Writer](https://communitynotes.x.com/guide/en/api/overview) (voir le Community Notes Guide). Une fois votre inscription approuv√©e, v√©rifiez que vous avez les cl√©s et jetons API appropri√©s √† utiliser dans les exemples ci-dessous. Consultez [cette section sur les fondamentaux](https://docs.x.com/resources/fundamentals/developer-apps#keys-and-tokens) pour obtenir des instructions sur l‚Äôobtention de vos cl√©s et jetons ‚Äî enregistrez votre cl√© API, votre secret API, votre jeton d‚Äôacc√®s et votre secret de jeton, car nous les utiliserons dans les exemples de ce guide. Les endpoints Community Notes prennent en charge l‚Äôauthentification OAuth 1.0 et 2.0. Dans ce guide, nous utiliserons OAuth 1.0.

<div id="search-for-x-posts-that-are-eligible-to-receive-a-community-note">
  ## Rechercher des Posts X pouvant recevoir une Community Note
</div>

Les d√©veloppeurs peuvent r√©cup√©rer une liste de Posts X pouvant recevoir une Community Note via l‚Äôendpoint `GET https://api.x.com/2/notes/search/posts_eligible_for_notes`. Cet endpoint exige de sp√©cifier le param√®tre test_mode et de le d√©finir sur true pour pouvoir l‚Äôutiliser.

**Remarque :** Pour l‚Äôinstant, test_mode ne peut √™tre d√©fini que sur true, sinon ces endpoints renverront une erreur de ce type :

```json
{
 "errors": [
   {
     "message": "The `test_mode` query parameter is invalid."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

Vous pouvez d√©finir le nombre maximal de Posts renvoy√©s par requ√™te √† l‚Äôaide du param√®tre max_results. Par d√©faut, 10 Posts sont renvoy√©s et un maximum de 100 peut √™tre r√©cup√©r√© par requ√™te. Si vous souhaitez davantage de r√©sultats, transmettez le pagination_token. 

Le code ci-dessous appelle l‚Äôendpoint de recherche qui renvoie les Posts √©ligibles aux Community Notes :

```python
from requests_oauthlib import OAuth1Session
import json

# API endpoint and parameters
url = "https://api.x.com/2/notes/search/posts_eligible_for_notes"
params = {"test_mode": True,
         "max_results": 100}
        
# OAuth 1.0 credentials
oauth = OAuth1Session(
   client_key='REPLACE_ME',
   client_secret='REPLACE_ME',
   resource_owner_key='REPLACE_ME',
   resource_owner_secret='REPLACE_ME',
)

# Make the request
try:
   response = oauth.get(url, params=params)
   response.raise_for_status()  # Raises an HTTPError for bad responses

   print("Response code: {}".format(response.status_code))
   json_response = response.json()
   print(json.dumps(json_response, indent=4, sort_keys=True))

except Exception as e:
   print(f"Request failed: {e}")
```

La r√©ponse ressemblera √† ceci :

```json
{
   "data": [
       {
           "text": "Join us to learn more about our new analytics endpoints available in the X API v2 üìä https://t.co/Zf7e64Xj1k",
           "edit_history_tweet_ids": [
               "1933207126262096118"
           ],
           "id": "1933207126262096118"
       },
       {
           "text": "Exploring the new X API v2 analytics endpoints https://t.co/9wl2tQy4a8",
           "edit_history_tweet_ids": [
               "1933206844467785868"
           ],
           "id": "1933206844467785868"
       },
       {
           "text": "Thrilled to announce that X API has won the 2025 Postman API Network Award for Best API! Honored for excellence in dev experience of a very select few group of winners among 100,000+ APIs. Thank you, @getpostman, and our amazing dev community! https://t.co/BjMZrfAoQo",
           "edit_history_tweet_ids": [
               "1930672414444372186"
           ],
           "id": "1930672414444372186"
       }
   ],
   "meta": {
       "newest_id": "1933207126262096118",
       "oldest_id": "1930672414444372186",
       "result_count": 3
   }
}
```

Vous pouvez utiliser l‚ÄôID du Post pr√©sent dans la r√©ponse ci-dessus pour r√©diger une Community Note.

Par d√©faut, vous recevez l‚ÄôID du Post, le texte et l‚Äôhistorique des modifications. Si vous souhaitez des champs suppl√©mentaires, vous pouvez utiliser les [fields](https://docs.x.com/x-api/fundamentals/fields) et les [expansions](https://docs.x.com/x-api/fundamentals/expansions)

<div id="search-for-community-notes-that-have-been-written-on-x-posts">
  ## Rechercher des Community Notes r√©dig√©es sur des Posts X
</div>

De la m√™me mani√®re, un d√©veloppeur peut r√©cup√©rer une liste de Community Notes r√©dig√©es par l‚Äôutilisateur authentifi√© √† l‚Äôaide de la requ√™te GET https://api.x.com/2/notes/search/notes_written. Cet endpoint requiert √©galement le param√®tre test_mode. Lorsque test_mode est d√©fini sur true, toutes les notes de test r√©dig√©es par l‚Äôutilisateur sont renvoy√©es.

**Remarque :** Pour l‚Äôinstant, test_mode ne peut √™tre d√©fini que sur true, sinon ces endpoints renverront une erreur de type :

```json
{
 "errors":[
   {
     "message":"The `test_mode` query parameter is invalid."
   }
 ],
 "title":"Invalid Request",
 "detail":"One or more parameters to your request was invalid.",
 "type":"https://api.twitter.com/2/problems/invalid-request"
}
```

Vous pouvez sp√©cifier le nombre maximal de Notes que vous souhaitez recevoir par requ√™te √† l‚Äôaide du param√®tre max_results. Par d√©faut, 10 Notes sont renvoy√©es et un maximum de 100 Notes peut √™tre r√©cup√©r√© par requ√™te. Si vous souhaitez obtenir davantage de r√©sultats, transmettez le pagination_token. 

Le code ci-dessous appelle l‚Äôendpoint de recherche qui renvoie les Notes r√©dig√©es sur des Posts X :

```python
from requests_oauthlib import OAuth1Session
import json


# API endpoint and parameters
url = "https://api.x.com/2/notes/search/notes_written"
params = {"test_mode": True,
         "max_results": 100, }

# OAuth 1.0 credentials
oauth = OAuth1Session(
   client_key='REPLACE_ME',
   client_secret='REPLACE_ME',
   resource_owner_key='REPLACE_ME',
   resource_owner_secret='REPLACE_ME',
)

# Make the request
try:
   response = oauth.get(url, params=params)
   response.raise_for_status()  # Raises an HTTPError for bad responses

   print("Response code: {}".format(response.status_code))
   json_response = response.json()
   print(json.dumps(json_response, indent=4, sort_keys=True))

except Exception as e:
   print(f"Request failed: {e}")
```

La r√©ponse sera similaire √† ceci :

```json
{
  "data": [
    {
      "id": "1939827717186494817",
      "info": {
        "text": "test note text. http://source.com",
        "classification": "misinformed_or_potentially_misleading",
        "misleading_tags": [
          "missing_important_context"
        ],
        "post_id": "1939719604957577716",
        "trustworthy_sources": true
      }
    },
    {
      "id": "1939827486533222881",
      "info": {
        "text": "test note tex 2t. http://source.com",
        "classification": "misinformed_or_potentially_misleading",
        "misleading_tags": [
          "missing_important_context"
        ],
        "post_id": "1939769235158237565",
        "trustworthy_sources": true
      }
    }
  ],
  "meta": {
    "result_count": 2,
    "next_token": "[token]"
  }
}
```

<div id="manage-community-notes">
  ## G√©rer les Community Notes
</div>

Les d√©veloppeurs peuvent soumettre des Community Notes sur des Posts X √† l‚Äôaide du point de terminaison POST https://api.x.com/2/notes. Comme pour les points de terminaison pr√©c√©dents, celui-ci prend √©galement en charge le param√®tre de requ√™te test_mode. Lorsque test_mode est d√©fini sur true, la note soumise est uniquement destin√©e aux tests et ne sera pas visible publiquement.

**Remarque :** Pour l‚Äôinstant, test_mode ne peut √™tre d√©fini que sur true, sinon ces points de terminaison renverront une erreur de type :

```json
{
 "errors": [
   {
     "message": "The `test_mode` query parameter is invalid."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

Pour ce faire, vous devez fournir le *post_id* du Post pour lequel vous souhaitez soumettre la Community Note dans le corps de la requ√™te de ce point de terminaison, ainsi que les informations requises pour cr√©er une note, notamment :

* *text* : le texte de la note, qui doit contenir au moins 1 caract√®re et au plus 280 caract√®res (les URL comptent pour un seul caract√®re) et doit inclure une URL source
* *classification* : qui peut √™tre soit misinformed_or_potentially_misleading, soit not_misleading
* *misleading_tags* : une liste non vide d‚Äô√©tiquettes parmi "disputed_claim_as_fact", "factual_error", "manipulated_media", "misinterpreted_satire", "missing_important_context", "outdated_information" ou "other". Ce champ est requis uniquement lorsque la classification est de type misinformed_or_potentially_misleading.
* *trustworthy_sources* : une valeur bool√©enne indiquant si une source fiable est fournie dans ‚Äútext‚Äù.

Ci-dessous un exemple de requ√™te vers ce point de terminaison

```python
from requests_oauthlib import OAuth1Session
import json


# Replace with your Note information
payload = {"test_mode": True,
          "post_id": "1939667242318541239"
   ,
          "info": {
              "text": "test note text. http://source.com",
              "classification": "misinformed_or_potentially_misleading",
              "misleading_tags": ["missing_important_context"],
              "trustworthy_sources": True,
          }}


# Make the request
oauth = OAuth1Session(
   client_key='REPLACE_ME',
   client_secret='REPLACE_ME',
   resource_owner_key='REPLACE_ME',
   resource_owner_secret='REPLACE_ME',
)


# Making the request
response = oauth.post(
   "https://api.twitter.com/2/notes",
   json=payload,
)


if response.status_code != 201:
   raise Exception(
       "Request returned an error: {} {}".format(response.status_code, response.text)
   )


print("Response code: {}".format(response.status_code))


# Saving the response as JSON
json_response = response.json()
print(json.dumps(json_response, indent=4, sort_keys=True))
```

Si la requ√™te r√©ussit, la r√©ponse sera la suivante :

```json
{
 "data": {
   "note_id": "1938678124100886981"
 }
}
```

<div id="error-troubleshooting">
  ## D√©pannage des erreurs
</div>

Vous trouverez ci-dessous une liste des messages d‚Äôerreur courants et des solutions lors de l‚Äôutilisation des endpoints de Community Notes :

<div id="401-unauthorized">
  ### 401 Non autoris√©
</div>

```json
{
 "title": "Unauthorized",
 "type": "about:blank",
 "status": 401,
 "detail": "Unauthorized"
}
```

**Explication** : Cette erreur est renvoy√©e lorsque la requ√™te n‚Äôest pas correctement authentifi√©e.

<div id="403-forbidden">
  ### 403 Interdit
</div>

```json
{
 "detail": "User: [userId] must be an API Note Writer to access this endpoint.",
 "type": "about:blank",
 "title": "Forbidden",
 "status": 403
}
```

**Explication**: Cette erreur est renvoy√©e lorsqu‚Äôun utilisateur n‚Äôest pas autoris√© √† utiliser cet endpoint.

<div id="400-invalid-request-test_mode">
  ### 400 Requ√™te invalide (test_mode)
</div>

```json
{
 "errors": [
   {
     "message": "The `test_mode` query parameter is invalid."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

**Explication**: Cette r√©ponse est renvoy√©e lorsqu‚Äôun utilisateur tente d‚Äôeffectuer une requ√™te avec test_mode d√©fini sur false

<div id="400-invalid-request-duplicate-note">
  ### 400 Requ√™te invalide (Note en double)
</div>

```json
{
 "errors": [
   {
     "message": "User already created a note: [noteId] for this post."
   }
 ],
 "title": "Invalid Request",
 "detail": "One or more parameters to your request was invalid.",
 "type": "https://api.twitter.com/2/problems/invalid-request"
}
```

**Explication** : Cette erreur est renvoy√©e lorsqu‚Äôun utilisateur tente de cr√©er une Note de la communaut√© en double.

<div id="resources">
  ## Ressources
</div>

Vous trouverez des exemples de code dans d‚Äôautres langages de programmation sur notre [page GitHub](https://github.com/xdevplatform/Twitter-API-v2-sample-code). Vous pouvez aussi commencer √† utiliser ces points de terminaison d‚ÄôAPI avec notre [collection Postman](https://www.postman.com/xapidevelopers). Si vous avez des questions techniques √† propos de ces points de terminaison, n‚Äôh√©sitez pas √† nous contacter sur les [forums d‚Äôassistance de la X Developer Community](https://devcommunity.x.com/).