---
title: "Account Activity API : Enterprise"
---

<Note>
  Ce point de terminaison a été mis à jour pour inclure les métadonnées d’édition de publication. Pour en savoir plus, consultez la page des notions de base [« Modifier des publications »](/fr/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets). 

  Ce point de terminaison est souvent utilisé avec les points de terminaison Direct Messages. Nous avons lancé de nouveaux [points de terminaison Direct Messages v2](/fr/x-api/direct-messages/manage/introduction). Notez que les Account Activity API Enterprise et Premium prennent en charge les messages v2 en tête‑à‑tête, mais ne prennent pas encore en charge les conversations de groupe.   
</Note>

Aperçu

`Enterprise`

L’Account Activity API vous permet de vous abonner en temps réel aux activités liées à un compte utilisateur via des webhooks. Vous pouvez ainsi recevoir en temps réel des publications, des Direct Messages et d’autres événements de compte provenant d’un ou plusieurs de vos comptes détenus ou suivis, au moyen d’une seule connexion.

Vous recevrez toutes les activités ci‑dessous pour chaque abonnement utilisateur sur votre enregistrement de webhook :

| Types d’activité |     |
| :--- | :--- |
| * Publications (par l’utilisateur)  <br />    <br />* Suppressions de publication (par l’utilisateur)<br />* @mentions (de l’utilisateur)<br />* Réponses (à l’utilisateur ou de l’utilisateur)<br />* Retweets (par l’utilisateur ou concernant l’utilisateur)<br />* Tweets cités (par l’utilisateur ou concernant l’utilisateur)<br />* Retweets de Tweets cités (par l’utilisateur ou concernant l’utilisateur)<br />* Mentions J’aime (par l’utilisateur ou concernant l’utilisateur)<br />* Abonnements (par l’utilisateur ou concernant l’utilisateur)  <br />    <br />* Désabonnements (par l’utilisateur) | * Blocages (par l’utilisateur)<br />* Déblocages (par l’utilisateur)<br />* Silencements (par l’utilisateur)<br />* Réactivations du son (par l’utilisateur)<br />* Direct Messages envoyés (par l’utilisateur)<br />* Direct Messages reçus (par l’utilisateur)<br />* Indicateurs de saisie (vers l’utilisateur)<br />* Accusés de lecture (vers l’utilisateur)<br />* Révocations d’abonnement (par l’utilisateur) |

**Veuillez noter** : nous ne diffusons pas les données du fil d’accueil via l’Account Activity API. Veuillez utiliser [GET statuses/home_timeline](https://developer.x.com/en/docs/x-api/v1/tweets/timelines/overview) pour récupérer ces données.
 

<div id="video-series">
  #### Série vidéo
</div>

Découvrez notre [série vidéo en quatre volets](https://www.youtube.com/watch?v=otPxejFhyy8\&index=0\&list=PLFKjcMIU2WshGG6Yj940XM7Z6BFs1zfBg) sur l’API Account Activity pour vous mettre rapidement à jour !

<iframe src="https://platform.x.com/embed/Tweet.html?dnt=false&embedId=twitter-widget-0&features=eyJ0ZndfdGltZWxpbmVfbGlzdCI6eyJidWNrZXQiOltdLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X2ZvbGxvd2VyX2NvdW50X3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9iYWNrZW5kIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19yZWZzcmNfc2Vzc2lvbiI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfZm9zbnJfc29mdF9pbnRlcnZlbnRpb25zX2VuYWJsZWQiOnsiYnVja2V0Ijoib24iLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X21peGVkX21lZGlhXzE1ODk3Ijp7ImJ1Y2tldCI6InRyZWF0bWVudCIsInZlcnNpb24iOm51bGx9LCJ0ZndfZXhwZXJpbWVudHNfY29va2llX2V4cGlyYXRpb24iOnsiYnVja2V0IjoxMjA5NjAwLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X3Nob3dfYmlyZHdhdGNoX3Bpdm90c19lbmFibGVkIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19kdXBsaWNhdGVfc2NyaWJlc190b19zZXR0aW5ncyI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdXNlX3Byb2ZpbGVfaW1hZ2Vfc2hhcGVfZW5hYmxlZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdmlkZW9faGxzX2R5bmFtaWNfbWFuaWZlc3RzXzE1MDgyIjp7ImJ1Y2tldCI6InRydWVfYml0cmF0ZSIsInZlcnNpb24iOm51bGx9LCJ0ZndfbGVnYWN5X3RpbWVsaW5lX3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9mcm9udGVuZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9fQ%3D%3D&frame=false&hideCard=false&hideThread=false&id=996790447048613888&lang=en&origin=https%3A%2F%2Fdeveloper.x.com%2Fen%2Fdocs%2Fx-api%2Fenterprise%2Faccount-activity-api%2Foverview&sessionId=81f4a0339cbd7bd77b669faa00bd3a7224bc4418&theme=light&widgetsVersion=2615f7e52b7e0%3A1702314776716&width=550px" height="400px" />

<div id="feature-summary">
  ### Récapitulatif des fonctionnalités
</div>

| Offre | Tarification | Nombre d’abonnements uniques | Nombre de webhooks | Fiabilité et reprise d’activité |
| :--- | :--- | :--- | :--- | :--- |
| Enterprise | [Contacter l’équipe commerciale](/fr/x-api/enterprise-gnip-2.0/enterprise-gnip) | Jusqu’à 500+ | 3+ | [Réessais](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) et [Relecture](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api) |

* Des questions ? Vous rencontrez des erreurs ?
  * Consultez notre [foire aux questions](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions) ou le [guide de dépannage des erreurs](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions).

* Explorez nos exemples de code :
  * [Tableau de bord Enterprise Account Activity API](https://github.com/xdevplatform/account-activity-dashboard-enterprise), une application web Node affichant les événements de webhook avec l’offre Enterprise de l’Account Activity API, incluant la fonctionnalité de [relecture](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api).
  * Le [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), une application web Ruby basée sur les API Enterprise Account Activity et Direct Message.

<div id="manage-webhooks-and-subscribed-users">
  ## Gérer les webhooks et les utilisateurs abonnés
</div>

**⏱ 10 min de lecture**

L’API Enterprise Account Activity fournit des messages JSON basés sur des webhooks dès qu’un événement est associé à des comptes X abonnés à votre service. X livre ces activités à votre webhook enregistré. Dans les étapes suivantes, vous apprendrez à gérer les webhooks et les utilisateurs abonnés.

Vous verrez comment enregistrer, afficher et supprimer des webhooks ainsi que des utilisateurs abonnés. Nous utiliserons de simples commandes cURL pour effectuer des requêtes vers les différents points de terminaison de l’API. cURL est un outil en ligne de commande permettant d’envoyer ou de récupérer des requêtes à l’aide de la syntaxe URL.

Vous aurez besoin de :

* D’une application X enregistrée - *[inscrivez-vous ici](https://developer.x.com/content/developer-twitter/en/apps)*
* D’un jeton d’accès (bearer) - *[en savoir plus](/fr/resources/fundamentals/authentication#using-and-generating-an-app-only-bearer-token)*
* D’un webhook qui passe le contrôle de défi-réponse (CRC) - *[en savoir plus](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks)*
* D’un compte Enterprise - *[postulez ici](https://developer.x.com/en/products/x-api/enterprise)*

*Avant de commencer, nous vous recommandons de consulter notre [dépôt GitHub](https://github.com/xdevplatform/account-activity-dashboard), qui fournit une application web d’exemple et des scripts d’aide pour démarrer avec l’API Account Activity de X.*

<div id="managing-a-webhook">
  #### Gestion d’un webhook :
</div>

L’utilisation d’un webhook vous permet de vous abonner, via une seule connexion, aux activités en temps réel liées à un compte utilisateur.

<Tabs>
  <Tab title="Ajouter un webhook">
    Commençons par enregistrer une nouvelle URL de webhook pour le contexte d’application donné.

    L’URL sera validée via une requête CRC avant l’enregistrement. Une fois le webhook enregistré, veillez à noter son ID, car vous en aurez besoin ultérieurement.

    Copiez la requête cURL suivante dans votre terminal après avoir adapté les éléments suivants :

    * **URL** `<URL>` p. ex. `https://yourdomain.com/webhooks/twitter/`

    * **Consumer key** `<CONSUMER_KEY>` p. ex. `xvz1evFS4wEEPTGEFPHBog`

    * **Access token** `<ACCESS_TOKEN>` p. ex.  `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request POST --url 'https://api.x.com/1.1/account_activity/webhooks.json?url=<URL>' --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>

  <Tab title="Afficher un webhook">
    Nous allons exécuter la commande suivante pour renvoyer toutes les URL de webhook enregistrées et leurs statuts pour l’application donnée.

    Copiez la requête cURL suivante dans votre terminal après avoir adapté l’élément suivant :

    * **Bearer token** `<BEARER_TOKEN>` p. ex. `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

      ```curl --request GET --url https://api.x.com/1.1/account_activity/webhooks.json --header 'authorization: Bearer <BEARER_TOKEN>'
      ```
  </Tab>

  <Tab title="Supprimer un webhook">
    Pour supprimer un webhook de la configuration de l’application fournie, copiez la requête cURL suivante dans votre terminal après avoir adapté les éléments suivants :

    * **Webhook ID** `<:WEBHOOK_ID>` p. ex. `1234567890`

    * **Consumer key** `<CONSUMER_KEY>` p. ex. `xvz1evFS4wEEPTGEFPHBog`

    * **Access token** `<ACCESS_TOKEN>` p. ex.  `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```curl --request DELETE --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>.json --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>
</Tabs>

<div id="managing-subscribed-users">
  #### Gestion des utilisateurs abonnés :
</div>

Une fois que vous avez enregistré un webhook, vous pouvez ajouter un utilisateur abonné à l’Account Activity API pour commencer à recevoir l’activité de son compte.

<Tabs>
  <Tab title="Ajout d’un abonnement">
    Commençons par abonner un utilisateur afin que vous receviez tous les types d’événements.

    Copiez la requête cURL suivante dans votre terminal après avoir remplacé les éléments suivants :

    * **ID du webhook** `<:WEBHOOK_ID>` ex. `1234567890`

    * **Nom de la clé consommateur** `<CONSUMER_KEY>` ex. `xvz1evFS4wEEPTGEFPHBog`

    * **Jeton d’accès de l’utilisateur abonné** `<SUBSCRIBING_USER'S_ACCESS_TOKEN>` ex. `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request POST --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>/subscriptions/all.json --header 'authorization: OAuth oauth_consumer_key="<CONSUMER_KEY>", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="<SUBSCRIBING_USER'S_ACCESS_TOKEN>", oauth_version="1.0"'
      ```
  </Tab>

  <Tab title="Affichage des abonnements">
    Pour afficher la liste de tous les abonnements par type d’activité pour un webhook donné, copiez la requête cURL suivante dans votre terminal après avoir remplacé les éléments suivants :

    * **ID du webhook** `<:WEBHOOK_ID>` ex. `1234567890`

    * **Jeton Bearer** `<BEARER_TOKEN>` ex. `AAAAAAAAAAAA0%2EUifi76ZC9Ub0wn...`

      ```
      curl --request GET --url https://api.x.com/1.1/account_activity/webhooks/<:WEBHOOK_ID>/subscriptions/all/list.json --header 'authorization: Bearer <BEARER_TOKEN>'
      ```
  </Tab>

  <Tab title="Suppression d’un abonnement">
    Après désactivation, tous les événements concernant l’utilisateur demandeur ne seront plus envoyés à l’URL du webhook.

    Pour désactiver un abonnement dans le contexte de l’utilisateur et de l’application fournis, copiez la requête cURL suivante dans votre terminal après avoir remplacé les éléments suivants :

    * **ID du webhook** `<:WEBHOOK_ID>` ex. `1234567890`

    * **Clé consommateur** `<CONSUMER_KEY>` ex. `xvz1evFS4wEEPTGEFPHBog`

    * **Jeton d’accès de l’utilisateur abonné** `<SUBSCRIBING_USER'S_ACCESS_TOKEN>` ex. `370773112-GmHxMAgYyLbNEtIKZeRNFsMKPR9EyMZeS9weJAEb`

      ```
      curl --request DELETE --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBED_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
      ```
  </Tab>
</Tabs>

Bravo ! Vous devriez maintenant être en mesure de gérer vos webhooks et les utilisateurs abonnés.

<div id="referenced-articles">
  #### Articles de référence
</div>

* [Présentation du Challenge-Response Check (CRC)](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks)
* [Types de données d’Account Activity](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-data-object-structure)
* [Gestion des webhooks et des abonnements](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#managing-webhooks-and-subscriptions)

<div id="a-video-walkthrough-of-the-account-activity-api">
  ## Présentation vidéo de l’API Account Activity
</div>

Dans cette présentation, vous découvrirez les fonctionnalités des offres Premium et Enterprise de l’API Account Activity.

À la fin de la vidéo, vous aurez appris à effectuer les actions suivantes :

* Enregistrer un webhook
* Ajouter un abonnement utilisateur
* Supprimer un abonnement utilisateur
* Recevoir les activités de compte
* Rejouer les activités de compte

<iframe src="https://platform.x.com/embed/Tweet.html?dnt=false&embedId=twitter-widget-0&features=eyJ0ZndfdGltZWxpbmVfbGlzdCI6eyJidWNrZXQiOltdLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X2ZvbGxvd2VyX2NvdW50X3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9iYWNrZW5kIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19yZWZzcmNfc2Vzc2lvbiI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfZm9zbnJfc29mdF9pbnRlcnZlbnRpb25zX2VuYWJsZWQiOnsiYnVja2V0Ijoib24iLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X21peGVkX21lZGlhXzE1ODk3Ijp7ImJ1Y2tldCI6InRydWV0bWVudCIsInZlcnNpb24iOm51bGx9LCJ0ZndfZXhwZXJpbWVudHNfY29va2llX2V4cGlyYXRpb24iOnsiYnVja2V0IjoxMjA5NjAwLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X3Nob3dfYmlyZHdhdGNoX3Bpdm90c19lbmFibGVkIjp7ImJ1Y2tldCI6Im9uIiwidmVyc2lvbiI6bnVsbH0sInRmd19kdXBsaWNhdGVfc2NyaWJlc190b19zZXR0aW5ncyI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdXNlX3Byb2ZpbGVfaW1hZ2Vfc2hhcGVfZW5hYmxlZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9LCJ0ZndfdmlkZW9faGxzX2R5bmFtaWNfbWFuaWZlc3RzXzE1MDgyIjp7ImJ1Y2tldCI6InRydWVfYml0cmF0ZSIsInZlcnNpb24iOm51bGx9LCJ0ZndfbGVnYWN5X3RpbWVsaW5lX3N1bnNldCI6eyJidWNrZXQiOnRydWUsInZlcnNpb24iOm51bGx9LCJ0ZndfdHdlZXRfZWRpdF9mcm9udGVuZCI6eyJidWNrZXQiOiJvbiIsInZlcnNpb24iOm51bGx9fQ%3D%3D&frame=false&hideCard=false&hideThread=false&id=1204084171334832128&lang=en&origin=https%3A%2F%2Fdeveloper.x.com%2Fen%2Fdocs%2Fx-api%2Fenterprise%2Faccount-activity-api%2Fquick-start%2Fa-visual-walkthrough-of-the-account-activity-api&sessionId=b5b8e259a4c6287be2413de9059093170036fb30&theme=light&widgetsVersion=2615f7e52b7e0%3A1702314776716&width=550px" />

* Vous avez des questions ? Vous rencontrez des erreurs ?
  * Lisez notre [foire aux questions](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions) ou le [guide de dépannage des erreurs](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#frequently-asked-questions).

* Explorez nos exemples de code :
  * [Enterprise Account Activity API dashboard](https://github.com/xdevplatform/account-activity-dashboard-enterprise), une application web Node qui affiche des événements de webhook en utilisant le niveau Enterprise de l’Account Activity API et inclut la fonctionnalité [Replay](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api).
  * Le [SnowBot chatbot](https://github.com/xdevplatform/SnowBotDev), une application web Ruby bâtie sur les API Enterprise Account Activity et Direct Message.

**Enterprise**

<div id="getting-started-with-webhooks">
  ## Prise en main des webhooks
</div>

L’API Account Activity est une API reposant sur des webhooks qui envoie des événements de compte à une application web que vous développez, déployez et hébergez.

Plusieurs aspects « techniques » doivent être réglés avant de pouvoir commencer à recevoir des événements webhook dans votre application consommatrice d’événements. Comme décrit ci-dessous, vous devrez créer une application X, obtenir l’accès à l’API Account Activity et développer une application web qui consomme les événements webhook. 

<div id="1-create-a-x-app">
  ### 1. Créez une application X.
</div>

* Créez une [application X](/fr/resources/fundamentals/developer-apps) avec un compte développeur approuvé depuis le [developer portal](/fr/resources/fundamentals/developer-portal). Si vous créez l’application au nom de votre entreprise, il est recommandé de la créer avec un compte X d’entreprise. Pour demander un compte développeur, [cliquez ici](/fr/resources/fundamentals/developer-apps).
* Activez « Read, Write and Access direct messages » dans l’onglet [Permissions](/fr/resources/fundamentals/developer-apps#oauth-1-0a-app-permissions) de la page de votre application.
* Dans l’onglet « Keys and Access Tokens », notez la Consumer Key (API Key) et le Consumer Secret (API Secret) de votre application.
* Dans le même onglet, générez les [Access Token et Access Token Secret](/fr/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow) de votre application. Vous aurez besoin de ces Access Tokens pour enregistrer l’URL de votre webhook, où X enverra les événements de compte.
* Si vous ne connaissez pas [X Sign-in](/fr/resources/fundamentals/authentication#log-in-with-x) ni le fonctionnement des contextes utilisateur avec l’API X, consultez [Obtaining Access Tokens](https://dev.x.com/webhooks/access-tokens). Lorsque vous ajoutez des comptes pour lesquels recevoir des événements, vous les abonnerez en utilisant les Access Tokens de ces comptes.
* Notez l’ID numérique de votre application, tel qu’affiché sur la page [« Apps »](/fr/resources/fundamentals/developer-apps) du [developer portal](/fr/resources/fundamentals/developer-portal). Lorsque vous demandez l’accès à l’Account Activity API, vous aurez besoin de cet ID d’application.
   

<div id="2-get-account-activity-api-access">
  ### 2. Obtenir l’accès à l’API Account Activity
</div>

Après avoir créé une application X, l’étape suivante consiste à demander l’accès à l’API Account Activity.

L’API Account Activity n’est disponible qu’en offre Enterprise ; vous devrez donc soumettre une demande via le lien ci-dessous.

<Button href="https://developer.x.com/en/enterprise-application.html">
  Demander l’accès Enterprise
</Button>

<div id="3-develop-webhook-consumer-app">
  ### 3. Développer une application consommatrice de webhooks
</div>

Une fois que vous avez obtenu l’accès à l’Account Activity API, vous devez développer, déployer et héberger une application web qui recevra les événements de webhooks X.

* Créez une application web avec une URL à utiliser comme webhook pour recevoir des événements. Il s’agit de l’endpoint déployé sur votre serveur pour écouter les événements de webhooks X entrants.
  * Le chemin d’URI est entièrement à votre discrétion. Cet exemple serait valide : https://mydomain.com_/service/listen_

  * Si vous écoutez des webhooks provenant de diverses sources, un modèle courant est : https://mydomain.com/webhook/twitter

  * Notez que l’URL spécifiée ne peut pas inclure de spécification de port (https://mydomain.com:5000/NoWorkie).

* Comme décrit dans notre guide [Sécuriser les webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks), une première étape consiste à écrire du code qui reçoit une requête GET X Challenge Response Check (CRC) et y répond avec une réponse JSON correctement formatée.

* Enregistrez votre URL de webhook. Vous effectuerez une requête POST vers l’endpoint /webhooks.json?url=. Lorsque vous effectuez cette requête, X émet une requête CRC vers votre application web. Lorsqu’un webhook est enregistré avec succès, la réponse inclut un identifiant de webhook. Cet identifiant de webhook sera nécessaire ultérieurement pour certaines requêtes à l’Account Activity API.

* X enverra des événements de webhook de compte à l’URL que vous avez enregistrée. Assurez-vous que votre application web prend en charge les requêtes POST pour les événements entrants. Ces événements seront encodés en JSON. Voir [ICI](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-data-object-structure) pour des exemples de charges utiles JSON de webhooks.

* Une fois votre application web prête, l’étape suivante consiste à ajouter des comptes pour lesquels recevoir des activités. Lors de l’ajout (ou de la suppression) de comptes, vous effectuerez des requêtes POST en référencant l’identifiant du compte. Consultez notre [guide sur l’ajout d’abonnements](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#managing-webhooks-and-subscriptions) pour plus d’informations.

<div id="4-validate-setup">
  ### 4. Valider la configuration
</div>

* Pour vérifier que votre application et votre webhook sont correctement configurés, aimez une Publication publiée par l’un des comptes X auxquels votre application est abonnée. Vous devriez recevoir un `favorite_events` via une requête POST à votre URL de webhook pour chaque J’aime reçu par vos abonnés.
* Notez que la livraison des événements peut prendre jusqu’à 10 secondes après l’ajout d’un abonnement.

**Notes importantes**

* Lors de l’enregistrement de votre URL de webhook, votre application web doit s’authentifier avec son jeton consommateur et son secret *et le jeton d’accès utilisateur et le secret du propriétaire de l’application*. 

* Tous les messages privés entrants seront livrés via des webhooks. Tous les messages privés envoyés via [POST direct_messages/events/new (message_create)](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) seront également livrés via des webhooks. Cela permet à votre application web d’être informée des messages privés envoyés via un autre client.

* Notez que chaque événement de webhook inclut un identifiant utilisateur for_user_id qui indique pour quel abonnement l’événement a été livré.

* Si deux utilisateurs utilisent votre application web pour des messages privés dans la même conversation, votre webhook recevra deux événements en double (un pour chaque utilisateur). Votre application web doit en tenir compte. 

* Si vous avez plusieurs applications web partageant la même URL de webhook et le même utilisateur associé à chaque application, le même événement sera envoyé plusieurs fois à votre webhook (une fois par application web).

* Dans certains cas, votre webhook peut recevoir des événements en double. Votre application webhook doit être tolérante à cela et dédupliquer par ID d’événement.

* N’attendez pas qu’une réponse de Quick Reply suive directement une demande. Un utilisateur peut ignorer une demande de Quick Reply et répondre via un message privé traditionnel. L’utilisateur peut également fournir une réponse de Quick Reply à une demande à laquelle il n’a pas répondu plus tôt dans le fil de messages.

* Voir du code d’exemple :
  * [Enterprise Account Activity API dashboard](https://github.com/xdevplatform/account-activity-dashboard-enterprise), une application web Node qui affiche les événements webhook à l’aide du niveau entreprise de l’Account Activity API et inclut la fonctionnalité [Replay](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api).

  * Le [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), une application web Ruby conçue sur les API Account Activity et Direct Message. Cette base de code inclut un [script](https://github.com/xdevplatform/SnowBotDev/wiki/Account-Activity-API-setup-script) pour aider à configurer les webhooks de l’Account Activity API.

<div id="securing-webhooks">
  ## Sécurisation des webhooks
</div>

Les API de X basées sur des webhooks proposent deux méthodes pour confirmer la sécurité de votre serveur de webhook :

1. Les vérifications de type challenge-response permettent à X de confirmer que vous êtes bien le propriétaire de l’application web qui reçoit les événements de webhook.
2. L’en-tête de signature présent dans chaque requête POST vous permet de confirmer que X est bien la source des webhooks entrants.
    

<div id="challenge-response-checks">
  ### Vérifications par défi-réponse
</div>

Afin de vérifier que vous êtes à la fois le propriétaire de l’application et de l’URL du webhook, X effectuera une vérification par défi-réponse (CRC), à ne pas confondre avec un contrôle de redondance cyclique. Lorsqu’un CRC est envoyé, X effectuera une requête GET vers votre application web avec un paramètre *`crc_token`*. Lorsque cette requête est reçue, votre application web doit générer un `response_token` chiffré à partir du paramètre *`crc_token`* et du Consumer Secret de votre application (détails ci-dessous). Le `response_token` doit être encodé en JSON (voir l’exemple ci-dessous) et renvoyé en moins de trois secondes. En cas de succès, un `id` de webhook sera renvoyé.

Un CRC est envoyé lorsque vous enregistrez votre URL de webhook ; implémenter votre code de réponse CRC est donc une première étape fondamentale. Une fois votre webhook établi, X déclenchera un CRC approximativement toutes les 24 heures à partir de la dernière fois que nous avons reçu une réponse valide. Votre application peut également déclencher un CRC au besoin en effectuant une requête PUT avec votre `id` de webhook. Déclencher un CRC est utile pendant le développement de votre application webhook, après le déploiement d’un nouveau code et le redémarrage de votre service.

Le *`crc_token`* doit être considéré comme changeant à chaque requête CRC entrante et doit être utilisé comme message dans le calcul, votre Consumer Secret servant de clé.

Si la réponse n’est pas renvoyée en moins de trois secondes ou devient invalide, les événements cesseront d’être envoyés au webhook enregistré.

<div id="the-crc-request-will-occur">
  #### La requête CRC aura lieu :
</div>

* Lorsqu’une URL de webhook est enregistrée.
* Environ *toutes les heures* pour valider votre URL de webhook.
* Vous pouvez déclencher manuellement un CRC en envoyant une requête PUT. À mesure que vous développez votre client de webhook, prévoyez de déclencher manuellement le CRC tout en mettant au point votre réponse CRC. 
   

<div id="response-requirements">
  #### Exigences de la réponse :
</div>

* Un hachage HMAC SHA-256 encodé en base64, calculé à partir du `crc_token` et du secret consommateur (Consumer Secret) de votre application
* Un `response_token` valide et un format JSON.
* Une latence inférieure à 3 secondes.
* Un code de réponse HTTP 200.
   

<div id="language-specific-hmac-libraries">
  #### Bibliothèques HMAC propres à chaque langage :
</div>

* [Java/Scala](https://docs.oracle.com/javase/8/docs/api/index.html?javax/crypto/Mac.html)
* [Ruby](http://ruby-doc.org/stdlib-2.1.0/libdoc/openssl/rdoc/OpenSSL/HMAC.html)
* [Node.js](https://nodejs.org/api/crypto.html#crypto_class_hmac)
* [Python](https://docs.python.org/2/library/hmac.html)

<div id="example-response-token-generation-in-python">
  #### Exemple de génération de jeton de réponse en Python :
</div>

Ce qui suit définit une route dans une application web Flask Python 2.7 qui répondra correctement à la vérification du challenge.

```
import base64
import hashlib
import hmac
import json


\# Définit une route pour la requête GET
@app.route('/webhooks/twitter', methods=\['GET'\])
def webhook_challenge():

  # crée un hachage HMAC SHA-256 à partir du jeton entrant et de votre secret consommateur
  sha256\_hash\_digest = hmac.new(TWITTER\_CONSUMER\_SECRET, msg=request.args.get('crc_token'), digestmod=hashlib.sha256).digest()

  # construit les données de réponse avec le hachage encodé en base64
  response = {
    'response\_token': 'sha256=' + base64.b64encode(sha256\_hash_digest)
  }

  # renvoie une réponse JSON correctement formatée
  return json.dumps(response)
```

<div id="example-json-response">
  #### Exemple de réponse JSON :
</div>

Avec la route définie comme ci-dessus, votre application web devrait renvoyer une réponse similaire à celle ci-dessous lorsque vous accédez à https://your-app-domain/webhooks/twitter?crc_token=foo dans votre navigateur.

```
{
  "response_token": "sha256=x0mYd8hz2goCTfcNAaMqENy2BFgJJfJOb4PdvTffpwg="
}
```

<div id="other-examples">
  #### Autres exemples :
</div>

* [ICI](https://github.com/xdevplatform/account-activity-dashboard/blob/master/helpers/security.js) un exemple de méthode de réponse CRC écrite en Node.js.
* [ICI](https://github.com/xdevplatform/SnowBotDev/blob/master/app/controllers/snow_bot_dev_app.rb) un exemple de méthode de réponse CRC écrite en Ruby (voir *generate_crc_response* et la route GET qui reçoit les événements CRC).

<div id="optional-signature-header-validation">
  ### Validation facultative de l’en-tête de signature
</div>

Lors de la réception d’une requête POST provenant de X, de l’envoi d’une requête GET pour créer un webhook ou d’une requête GET pour effectuer un CRC manuel, une signature de hachage est transmise dans les en-têtes sous x-twitter-webhooks-signature. Cette signature permet de vérifier que la source des données est X. La signature de hachage POST commence par sha256=, indiquant l’utilisation de HMAC SHA-256 pour signer votre X App Consumer Secret et la charge utile. Le hachage GET est calculé à partir de la chaîne de paramètres de requête crc_token=$token&amp;nonce=$nonce.

**Étapes pour valider une requête**

1. Créez un hachage à l’aide de votre consumer secret et du corps de la charge utile entrante.
2. Comparez le hachage obtenu avec la valeur x-twitter-webhooks-signature encodée en base64. Utilisez une méthode comme [compare_digest](https://docs.python.org/2/library/hmac.html) pour réduire la vulnérabilité aux attaques par temporisation.

<div id="additional-security-guidelines">
  ### Directives de sécurité supplémentaires
</div>

Voici des directives de sécurité supplémentaires à prendre en compte pour votre application web. Le fait de ne pas les mettre en œuvre n’empêchera pas votre webhook de fonctionner, mais elles sont fortement recommandées par l’équipe X Information Security. Si vous n’êtes pas familier avec les recommandations ci-dessous, consultez votre administrateur système.

<div id="x-aggregate-network-blocks">
  #### Blocs réseaux agrégés X
</div>

Pour renforcer la sécurité, vous pouvez ajouter les blocs réseaux agrégés suivants à une liste d’autorisation (allowlist) :

* 199.59.148.0/22

* 199.16.156.0/22

* 192.133.77.0/26

* 64.63.15.0/24

* 64.63.31.0/24

* 64.63.47.0/24

* 202.160.128.0/24

* 202.160.129.0/24

* 202.160.130.0/24

<div id="recommended-server-configurations">
  #### Configurations serveur recommandées
</div>

* Note « A » au test [ssllabs.com](http://ssllabs.com/)
* **Activer TLS 1.2**
* Activer la confidentialité persistante (Perfect Forward Secrecy)
* Désactiver SSLv2
* Désactiver SSLv3 (à cause de POODLE)
* Désactiver TLS 1.0
* Désactiver TLS 1.1
* Désactiver la compression TLS
* Désactiver les tickets de session, sauf si vous faites tourner/renouvelez régulièrement les clés de tickets de session.
* Régler l’option « ssl_prefer_server_ciphers » ou « SSLHonorCipherOrder » sur « on » dans la configuration SSL.
* S’assurer que la liste de suites cryptographiques est moderne, par exemple :
  `ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES128-SHA256:AES128-SHA:AES256-GCM-SHA384:AES256-SHA256:AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:DES-CBC3-SHA`

<div id="managing-webhooks-and-subscriptions">
  ## Gestion des webhooks et des abonnements
</div>

<div id="creating-changing-webhooks">
  ### Création et modification des webhooks
</div>

Pour modifier les URL de webhook, vous devez supprimer le webhook existant, puis en créer un nouveau. Notez que lorsque vous procédez ainsi, vous devrez réinscrire les utilisateurs au nouveau webhook.

<div id="webhook-configuration-management-endpoints">
  #### Points de terminaison pour la gestion de la configuration des webhooks :
</div>

|     |     |
| :--- | :--- |
| **Méthode** | Enterprise |
| Enregistre une URL de webhook / Génère un webhook_id | [POST webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) |
| Renvoie toutes les URL de webhook et leurs statuts | [GET webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |
| Supprime la configuration de webhook actuelle de l’app | [DELETE webhooks/:webhook_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) |
| Déclenche manuellement une requête CRC | [PUT webhooks/:webhook_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) |

<div id="why-cant-i-just-update-the-webhook-url">
  #### Pourquoi ne puis‑je pas simplement mettre à jour l’URL du webhook ?
</div>

Pourquoi les configurations de webhook sont-elles immuables ? X accorde une importance primordiale à la sécurité. Si l’URL de votre webhook est modifiée, il est possible que la clé consommateur (consumer key) et le secret consommateur (consumer secret) de votre application aient été compromis. En vous demandant de créer une nouvelle configuration de webhook, vous devez également vous réabonner aux événements de vos utilisateurs. Cela nécessite l’utilisation de jetons d’accès qu’une partie malveillante est moins susceptible de détenir. Par conséquent, la probabilité qu’un tiers reçoive des informations privées sur vos utilisateurs est réduite.
 

<div id="adding-removing-user-subscriptions">
  ### Ajout et suppression d’abonnements utilisateur
</div>

La prise en charge de milliers d’abonnements est disponible avec l’offre Enterprise. Si vous avez déjà un responsable de compte, veuillez le contacter pour toute question. Pour demander l’accès aux API Enterprise, [cliquez ici](https://developer.x.com/en/products/x-api/enterprise). 

<div id="subscription-management-endpoints">
  #### Points de terminaison de gestion des abonnements
</div>

|     |     |
| :--- | :--- |
| Méthode | Enterprise |
| Ajouter un nouvel abonnement utilisateur | [POST webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) |
| Récupérer un abonnement utilisateur | [GET webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) |
| Renvoie la liste de tous les abonnements actifs | [GET webhooks/:webhook_id/subscriptions/all/list](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| Désactive un abonnement utilisateur à l’aide de l’authentification OAuth « application only » | [DELETE webhooks/:webhook_id/subscriptions/:user_id/all.json](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |

Account Activity API: Enterprise

<Note>
  **Veuillez noter** : 

  X doit activer l’accès à l’Account Activity API pour votre application développeur avant que vous ne puissiez commencer à utiliser l’API. À cette fin, veillez à communiquer l’ID de l’app que vous comptez utiliser pour l’authentification à votre chargé de compte ou à l’équipe d’assistance technique.
</Note>

L’[Account Activity API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity) se compose d’un ensemble de points de terminaison qui vous permettent de créer et de gérer des abonnements utilisateur afin de recevoir en temps réel les activités de compte pour l’ensemble de vos comptes abonnés via une connexion unique. 

Deux méthodes d’authentification sont disponibles avec l’Account Activity API ([OAuth 1.0a](/fr/resources/fundamentals/authentication#oauth-1-0a-2) et [OAuth 2.0 Bearer Token](/fr/resources/fundamentals/authentication#bearer-token-also-known-as-app-only)). La méthode d’authentification à utiliser dépend du point de terminaison ciblé.

|     |     |     |     |
| :--- | :--- | :--- | :--- |
| **Description** | **Endpoint ** | OAuth 1.0a  <br />(contexte utilisateur) | Jeton d’accès OAuth 2.0 (application uniquement) |
| Enregistrer une nouvelle URL de webhook pour le contexte d’application donné | [POST account_activity/webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) | ✓   |     |
| Renvoyer toutes les URL et leur statut pour l’application donnée | [GET account_activity/webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |     | ✓   |
| Déclencher une vérification de réponse au challenge (CRC) pour l’URL d’un webhook donné | [PUT account_activity/webhooks/:webhook_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) | ✓   |     |
| Abonner l’application aux événements du compte d’un utilisateur | [POST account_activity/webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ * |     |
| Renvoyer un décompte des abonnements actifs | [GET account_activity/subscriptions/count](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |     | ✓   |
| Vérifier si une configuration de webhook est abonnée aux événements d’un utilisateur | [GET account_activity/webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ * |     |
| Renvoyer la liste des abonnements actifs | [GET account_activity/webhooks/:webhook_id/subscriptions/all/list](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all-list) |     | ✓   |
| Supprimer un webhook | [DELETE account_activity/webhooks/:webhook_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) | ✓   |     |
| [OBSOLÈTE] Désactiver un abonnement pour le contexte utilisateur et l’application fournis | [DELETE account_activity/webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) | ✓ * |     |
| Désactiver un abonnement à l’aide d’OAuth en mode application uniquement | [DELETE /account_activity/webhooks/:webhook_id/subscriptions/:user_id/all.json](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |     | ✓   |
| Réexpédier des activités à un webhook | [POST /1.1/account_activity/replay/webhooks/:webhook_id/subscriptions/all.json](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#replay-api) |     | ✓   |

*_ L’authentification requiert les jetons d’accès de l’utilisateur abonné. _

Pour les endpoints nécessitant une authentification OAuth 1.0a en contexte utilisateur, vous devrez fournir les identifiants suivants pour authentifier la requête : 

* Clés consommateur (clé API et secret)
* Jetons d’accès (jeton d’accès et secret)

Dans le cas des trois endpoints suivants, vous effectuez des opérations d’écriture dans le contexte de votre application (aucun utilisateur X n’est impliqué). Par conséquent, les jetons d’accès à fournir sont ceux de votre application développeur. Ils peuvent être générés directement depuis le [developer portal](https://developer.x.com/en/portal/projects-and-apps), sous l’onglet « Keys and tokens » de votre application.  

* [POST account_activity/webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) : Enregistrer une nouvelle URL de webhook pour le contexte d’application donné
* [PUT account_activity/webhooks/:webhook_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) : Déclencher une vérification CRC (challenge-response check) pour l’URL d’un webhook donné
* [DELETE account_activity/webhooks/:webhook_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) : Supprimer un webhook

En revanche, pour les trois points de terminaison suivants, vous effectuez une requête qui permet à votre application d’accéder à des données protégées pour le compte d’un utilisateur X (par exemple, les Messages privés). Vous devez donc fournir les jetons d’accès (Access Tokens) appartenant à l’utilisateur abonné concerné. Les jetons d’accès requis peuvent être obtenus via le flux OAuth à 3 volets (voir [OAuth 1.0a : comment obtenir les jetons d’accès d’un utilisateur](/fr/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow)). Ces points de terminaison sont marqués d’un astérisque dans le tableau ci-dessus (*).

* [POST account_activity/webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) : Abonner l’application aux événements du compte d’un utilisateur
* [GET account_activity/webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) : Vérifier si une configuration de webhook est abonnée aux événements d’un utilisateur
* [DELETE account_activity/webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) : Désactiver un abonnement pour le contexte utilisateur et l’application fournis [OBSOLÈTE]

<Note>
  **Veuillez noter** : 

  Assurez-vous que votre application développeur est activée pour « Read, Write, and Direct Messages ». Vous pouvez modifier ce paramètre dans la [section Projects &amp; Apps](https://developer.x.com/en/portal/projects-and-apps) de votre compte développeur, sous « App permissions » pour l’application développeur sélectionnée. Vous devrez régénérer les identifiants de votre application après avoir modifié les paramètres d’autorisations.
</Note>

La liste de tous les points de terminaison disponibles avec l’Account Activity API, incluant la description associée et des exemples de requêtes cURL avec des exemples d’implémentation de l’authentification, est disponible dans [la documentation de référence de l’API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index).

Pour plus d’informations, consultez [l’application web d’exemple et les scripts d’assistance](https://github.com/xdevplatform/account-activity-dashboard-enterprise) de XDev pour démarrer avec l’Enterprise Account Activity API.

<Note>
  **Veuillez noter** : 

  X doit activer l’accès à l’Account Activity API pour votre application développeur avant que vous ne puissiez commencer à utiliser l’API. À cette fin, veillez à communiquer l’App ID que vous comptez utiliser à des fins d’authentification à votre responsable de compte ou à votre équipe d’assistance technique.
</Note>

L’[Account Activity API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity) se compose d’un ensemble de points de terminaison qui vous permettent de créer et de gérer des abonnements d’utilisateurs afin de recevoir en temps réel les activités de compte pour tous vos comptes abonnés via une seule connexion.

Deux méthodes d’authentification sont disponibles avec l’Account Activity API ([OAuth 1.0a](/fr/resources/fundamentals/authentication#oauth-1-0a-2) et [OAuth 2.0 Bearer Token](/fr/resources/fundamentals/authentication#oauth-2-0)). La méthode d’authentification à utiliser dépend du point de terminaison ciblé.

|     |     |     |     |
| :--- | :--- | :--- | :--- |
| **Description** | **Endpoint ** | OAuth 1.0a  <br />(contexte utilisateur) | Jeton Bearer OAuth 2.0 (application uniquement) |
| Enregistrer une nouvelle URL de webhook pour le contexte d’application donné | [POST account_activity/webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) | ✓   |     |
| Renvoyer toutes les URL et leurs statuts pour l’application donnée | [GET account_activity/webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |     | ✓   |
| Déclencher un contrôle de réponse au défi (CRC) pour l’URL d’un webhook donné | [PUT account_activity/webhooks/:webhook_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) | ✓   |     |
| Abonner l’application aux événements de compte d’un utilisateur | [POST account_activity/webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ * |     |
| Renvoyer le nombre d’abonnements actuellement actifs | [GET account_activity/subscriptions/count](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |     | ✓   |
| Vérifier si une configuration de webhook est abonnée aux événements d’un utilisateur | [GET account_activity/webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) | ✓ * |     |
| Renvoyer la liste des abonnements actuellement actifs | [GET account_activity/webhooks/:webhook_id/subscriptions/all/list](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all-list) |     | ✓   |
| Supprimer un webhook | [DELETE account_activity/webhooks/:webhook_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) | ✓   |     |
| [OBSOLÈTE] Désactiver un abonnement pour le contexte utilisateur et l’application fournis | [DELETE account_activity/webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) | ✓ * |     |
| Désactiver un abonnement à l’aide d’une authentification OAuth « application uniquement » | [DELETE /account_activity/webhooks/:webhook_id/subscriptions/:user_id/all.json](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |     | ✓   |
| Relivrer des activités à un webhook | [POST /1.1/account_activity/replay/webhooks/:webhook_id/subscriptions/all.json](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#replay-api) |     | ✓   |

*_ L’authentification requiert les jetons d’accès de l’utilisateur abonné. _

Pour les endpoints qui nécessitent une authentification OAuth 1.0a en contexte utilisateur, vous devez fournir les identifiants suivants pour authentifier la requête : 

* Consumer Keys (API Key et Secret)
* Access Tokens (Access Token et Secret)

Pour les trois endpoints suivants, vous effectuez des opérations d’écriture dans le contexte de votre application (aucun utilisateur X n’est impliqué). Par conséquent, les Access Tokens à fournir sont ceux de votre application développeur. Ils peuvent être générés directement depuis le [developer portal](https://developer.x.com/en/portal/projects-and-apps), sous l’onglet « Keys and tokens » de votre application.  

* [POST account_activity/webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks) : Enregistrer une nouvelle URL de webhook pour le contexte d’application donné
* [PUT account_activity/webhooks/:webhook_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) : Déclencher un contrôle de réponse au défi (CRC) pour l’URL d’un webhook donné
* [DELETE account_activity/webhooks/:webhook_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) : Supprimer un webhook

En revanche, pour les trois endpoints suivants, vous effectuez une requête permettant à votre application d’accéder à des données protégées au nom d’un utilisateur X (par exemple, les Messages privés). Vous devez donc fournir les jetons d’accès (Access Tokens) appartenant à l’utilisateur abonné concerné. Les jetons d’accès requis peuvent être obtenus via le flux OAuth à 3 étapes (voir [OAuth 1.0a : comment obtenir les jetons d’accès d’un utilisateur](/fr/resources/fundamentals/authentication#obtaining-access-tokens-using-3-legged-oauth-flow)). Ces endpoints sont marqués d’un astérisque dans le tableau ci-dessus (*).

* [POST account_activity/webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) : Abonner l’application aux événements du compte d’un utilisateur
* [GET account_activity/webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) : Vérifier si une configuration de webhook est abonnée aux événements d’un utilisateur
* [DELETE account_activity/webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) : Désactiver un abonnement pour le contexte utilisateur et l’application fournis [DÉPRÉCIÉ]

<Note>
  **Veuillez noter** : 

  Assurez-vous que votre application développeur est activée pour « Read, Write, and Direct Messages ». Vous pouvez modifier ce paramètre dans la [section Projects &amp; Apps](https://developer.x.com/en/portal/projects-and-apps) de votre compte développeur, sous « App permissions » pour l’application développeur sélectionnée. Vous devrez régénérer les identifiants de votre application après avoir modifié les paramètres d’autorisations.
</Note>

La liste de tous les endpoints disponibles avec l’Account Activity API, incluant leur description et des exemples de requêtes cURL avec implémentations d’authentification, est disponible dans [la documentation de référence de l’API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index).

Pour plus d’informations, consultez les [exemples d’application web et scripts utilitaires](https://github.com/xdevplatform/account-activity-dashboard-enterprise) de XDev pour démarrer avec l’Enterprise Account Activity API.

<div id="retries">
  ## Réessais
</div>

`Enterprise`

L’un des avantages du niveau Enterprise de l’Account Activity API est un mécanisme de nouvelle tentative pour les événements webhook. Si un code de réponse HTTP 200 « success » n’est pas reçu, le serveur X lancera un mécanisme de nouvelle tentative, renvoyant l’événement webhook jusqu’à trois fois sur une période de cinq minutes. Ce service de nouvelle tentative pour les événements webhook contribue à assurer la fiabilité et la reprise des événements en cas de problèmes réseau, ainsi que lors d’interruptions côté client et de déploiements.
 

<div id="what-are-retries">
  ### Qu’est-ce que les relances ?
</div>

L’Account Activity API offre une fonctionnalité de relance lorsque l’application web du client ne renvoie pas une réponse 200 « success » pour un événement de webhook d’activité de compte. Lorsque le client ne confirme pas la bonne réception d’un événement, X suppose que l’événement n’a pas été reçu. Si une réponse non 200 est renvoyée, si aucune réponse n’est reçue sous trois secondes, ou si nous ne recevons aucune réponse, nous réessayons la requête et la laissons ouverte pendant trois secondes. Cela signifie que vous disposez d’environ cinq secondes réparties sur deux tentatives pour répondre et recevoir l’activité que nous tentons d’envoyer à votre URL de webhook. Si votre serveur ne répond pas ou renvoie une erreur transitoire, nous réessaierons pendant cinq minutes. Il y aura au total trois tentatives de relance pour confirmer la validation. Cela offre de la redondance et vous garantit la réception de tous les événements de webhook. Notez que les abonnements avec relances recevront des événements relancés pour toutes les activités de tous les utilisateurs abonnés sur leur webhook.

Si vous ne confirmez pas la validation au cours de ces huit tentatives, l’activité ne sera plus disponible via l’Account Activity API. 

<div id="retry-timeline">
  ### Calendrier des nouvelles tentatives
</div>

L’API Account Activity effectuera jusqu’à trois nouvelles tentatives sur une période de cinq minutes, jusqu’à réception d’une réponse 200. Reportez-vous au tableau ci-dessous pour plus de détails. Après environ cinq minutes, l’activité ne peut plus être renvoyée via l’API Account Activity. Vous devrez utiliser d’autres endpoints X pour récupérer les données manquées. Par exemple, les [APIs de recherche](/fr/x-api/enterprise-gnip-2.0/fundamentals/search-api) peuvent être utilisées pour récupérer les Posts, Retweets, Quote Tweets, Mentions et Replies pertinents. Les Direct Messages manqués peuvent être récupérés avec [cet endpoint](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events).

<div id="retries-timeline">
  #### Chronologie des nouvelles tentatives
</div>

|     |
| :--- |
| Activité créée, envoi d’un POST vers l’URL du webhook via l’API Account Activity, qui expire au bout de trois secondes. |
| Attendre trois secondes après la fin de l’expiration précédente, puis envoyer un POST vers l’URL du webhook via l’API Account Activity, qui expire au bout de trois secondes. |
| Attendre 27 secondes après la fin de l’expiration précédente, puis envoyer un POST vers l’URL du webhook via l’API Account Activity, qui expire au bout de trois secondes. |
| Attendre 242 secondes après la fin de l’expiration précédente, puis envoyer un POST vers l’URL du webhook via l’API Account Activity, qui expire au bout de trois secondes. |
| L’API Account Activity cessera toute tentative de POST après cela. Le client doit utiliser d’autres endpoints X pour récupérer les données. |

<div id="account-activity-data-object-structure">
  ## Structure de l’objet de données Account Activity
</div>

| Objet | Détails |
| :--- | :--- |
| for_user_id | Identifie l’abonnement utilisateur auquel l’événement est lié. |
| is_blocked_by | (conditionnel) Affiché uniquement lorsqu’un autre utilisateur mentionne l’utilisateur abonné. Inclus si true pour les événements de mention de publication uniquement. |
| source | L’utilisateur qui effectue l’activité. Par exemple, l’utilisateur qui suit, bloque ou met en sourdine est l’utilisateur source. |
| target | L’utilisateur auquel l’activité s’applique. Par exemple, l’utilisateur qui est suivi, bloqué ou mis en sourdine est l’utilisateur cible. |

**Activités disponibles**

| Type de message | Détails |
| :--- | :--- |
| [tweet_create_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-create-events-posts-retweets-replies-quotetweets) | Charge utile de statut de publication lorsque l’une des actions suivantes est effectuée par ou à l’utilisateur abonné : publications, Retweets, réponses, @mentions, Quote Tweets, Retweet de Quote Tweet. |
| [favorite_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#favorite-events) | Événement d’ajout aux favoris (like) avec l’utilisateur et la cible. |
| [follow_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#follow-events) | Événement de suivi avec l’utilisateur et la cible. |
| [unfollow_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unfollow-events) | Événement de désabonnement (arrêt de suivi) avec l’utilisateur et la cible. |
| [block_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#block-events) | Événement de blocage avec l’utilisateur et la cible. |
| [unblock_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unblock-events) | Événement de déblocage avec l’utilisateur et la cible. |
| [mute_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#mute-events) | Événement de mise en sourdine avec l’utilisateur et la cible. |
| [unmute_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#unmute-events) | Événement d’annulation de la mise en sourdine avec l’utilisateur et la cible. |
| [user_event](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#user-event) | Événements de révocation envoyés lorsqu’un utilisateur retire l’autorisation de l’application et que l’abonnement est automatiquement supprimé. |
| [direct_message_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-events) | Événement de message privé avec l’utilisateur et la cible lorsqu’un message privé est envoyé ou reçu. |
| [direct_message_indicate_typing_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-indicate-typing-events) | Événement d’indication de saisie pour message privé avec l’utilisateur et la cible. |
| [direct_message_mark_read_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-mark-read-events) | Événement de lecture de message privé avec l’utilisateur et la cible. |
| [tweet_delete_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-delete-events) | Notification de publications supprimées pour faciliter le respect de la conformité. |

**Exemples de charge utile**

Voir ci-dessous les exemples de charge utile pour chaque événement Account Activity décrit dans le tableau ci-dessus.

#### tweet_create_events (Posts, Retweets, Réponses, Tweets cités) 

```
{
	"for_user_id": "2244994945",
	"tweet_create_events": [
	  {
		<Tweet Object>
	  }
	]
}
```

#### tweet_create_events (@mentions) 

```
{
	"for_user_id": "2244994945",
	"user_has_blocked": "false",
	"tweet_create_events": [
	  {
		<Tweet Object>
	  }
	]
}
```

<div id="favorite_events">
  #### favorite_events
</div>

```
{
	"for_user_id": "2244994945",
	"favorite_events": [{
		"id": "a7ba59eab0bfcba386f7acedac279542",
		"created_at": "Mon Mar 26 16:33:26 +0000 2018",
		"timestamp_ms": 1522082006140,
		"favorited_status": {
			<Tweet Object>
		},
		"user": {
			<User Object>
		}
	}]
}
```

<div id="follow_events">
  #### follow_events
</div>

```
{
	"for_user_id": "2244994945",
	"follow_events": [{
			"type": "follow",
			"created_timestamp": "1517588749178",
			"target": {
				< Objet User >
			},
			"source": {
				< Objet User >
			}
		]
	}
}
```

<div id="unfollow_events">
  #### unfollow_events
</div>

```
{
	"for_user_id": "2244994945",
	"follow_events": [{
			"type": "unfollow",
			"created_timestamp": "1517588749178",
			"target": {
				<Objet utilisateur>
			},
			"source": {
				<Objet utilisateur>
			}
		]
	}
}
```

<div id="block_events">
  #### block_events
</div>

```
{
	"for_user_id": "2244994945",
	"block_events": [{
		"type": "block",
		"created_timestamp": "1518127020304",
		"source": {
			<User Object>
		},
		"target": {
			<User Object>
		}
	}]
}
```

<div id="unblock_events">
  #### unblock_events
</div>

```
{
	"for_user_id": "2244994945",
	"block_events": [{
		"type": "unblock",
		"created_timestamp": "1518127020304",
		"source": {
			<User Object>
		},
		"target": {
			<User Object>
		}
	}]
}
```

<div id="mute_events">
  #### mute_events
</div>

```
{
	"for_user_id": "2244994945",
	"mute_events": [
		{
			"type": "mute",
		  	"created_timestamp": "1518127020304",
			"source": {
				<Object Utilisateur>
			},
			"target": {
				<Object Utilisateur>
			}
		}
	]
}
```

<div id="unmute_events">
  #### unmute_events
</div>

```
{
	"for_user_id": "2244994945",
	"mute_events": [
		{
			"type": "unmute",
		  	"created_timestamp": "1518127020304",
			"source": {
				<User Object>
			},
			"target": {
				<User Object>
			}
		}
	]
}
```

<div id="user_event">
  #### user_event
</div>

```
{
	"user_event": {
		"revoke": {
			"date_time": "2018-05-24T09:48:12+00:00",
			"target": {
				"app_id": "13090192"
			},
			"source": {
				"user_id": "63046977"
			}
		}
	}
}
```

<div id="direct_message_events">
  #### direct_message_events
</div>

```
{
  	"for_user_id": "4337869213",
	"direct_message_events": [{
		"type": "message_create",
		"id": "954491830116155396",
		"created_timestamp": "1516403560557",
		"message_create": {
			"target": {
				"recipient_id": "4337869213"
			},
			"sender_id": "3001969357",
			"source_app_id": "13090192",
			"message_data": {
				"text": "Hello World!",
				"entities": {
					"hashtags": [],
					"symbols": [],
					"user_mentions": [],
					"urls": []
				}
			}
		}
	}],
	"apps": {
		"13090192": {
			"id": "13090192",
			"name": "FuriousCamperTestApp1",
			"url": "https://x.com/furiouscamper"
		},
		"users": {},
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter Ego - X PE opinions-are-my-own",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 22,
			"friends_count": 45,
			"statuses_count": 494,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		},
		"4337869213": {
			"id": "4337869213",
			"created_timestamp": "1448312972328",
			"name": "Harrison Test",
			"screen_name": "Harris_0ff",
			"location": "Burlington, MA",
			"protected": false,
			"verified": false,
			"followers_count": 8,
			"friends_count": 8,
			"profile_image_url": "null",
			"statuses_count": 240,
			"profile_image_url_https": "https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png"
		}
	}
}
```

<div id="direct_message_indicate_typing_events">
  #### direct_message_indicate_typing_events
</div>

```
{
	"for_user_id": "4337869213",
	"direct_message_indicate_typing_events": [{
		"created_timestamp": "1518127183443",
		"sender_id": "3284025577",
		"target": {
			"recipient_id": "3001969357"
		}
	}],
	"users": {
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter Ego - X PE opinions-are-my-own",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 23,
			"friends_count": 47,
			"statuses_count": 509,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		},
		"3284025577": {
			"id": "3284025577",
			"created_timestamp": "1437281176085",
			"name": "Bogus Bogart",
			"screen_name": "bogusbogart",
			"protected": true,
			"verified": false,
			"followers_count": 1,
			"friends_count": 4,
			"statuses_count": 35,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/763383202857779200/ndvZ96mE_normal.jpg"
		}
	}
}
```

<div id="direct_message_mark_read_events">
  #### direct_message_mark_read_events
</div>

```
{
	"for_user_id": "4337869213",
	"direct_message_mark_read_events": [{
		"created_timestamp": "1518452444662",
		"sender_id": "199566737",
		"target": {
			"recipient_id": "3001969357"
		},
		"last_read_event_id": "963085315333238788"
	}],
	"users": {
		"199566737": {
			"id": "199566737",
			"created_timestamp": "1286429788000",
			"name": "Le Braat",
			"screen_name": "LeBraat",
			"location": "Denver, CO",
			"description": "data le jour @X, design au crépuscule",
			"protected": false,
			"verified": false,
			"followers_count": 299,
			"friends_count": 336,
			"statuses_count": 752,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/936652894371119105/YHEozVAg_normal.jpg"
		},
		"3001969357": {
			"id": "3001969357",
			"created_timestamp": "1422556069340",
			"name": "Jordan Brinks",
			"screen_name": "furiouscamper",
			"location": "Boulder, CO",
			"description": "Alter ego — PE chez X — opinions personnelles",
			"url": "https://t.co/SnxaA15ZuY",
			"protected": false,
			"verified": false,
			"followers_count": 23,
			"friends_count": 48,
			"statuses_count": 510,
			"profile_image_url": "null",
			"profile_image_url_https": "https://pbs.twimg.com/profile_images/851526626785480705/cW4WTi7C_normal.jpg"
		}
	}
}
```

<div id="tweet_delete_events">
  #### tweet_delete_events
</div>

```
{
    "for_user_id": "930524282358325248",
    "tweet_delete_events": [
{
        "status": {
            "id": "1045405559317569537",
            "user_id": "930524282358325248"
        },
        "timestamp_ms": "1432228155593"
    }
   ]
}
```

<div id="account-activity-replay-api">
  ## API de relecture de l’activité de compte
</div>

`Enterprise`

L’API de relecture de l’activité de compte est un outil de récupération de données qui vous permet de récupérer des événements jusqu’à cinq jours en arrière. Elle doit être utilisée pour restaurer des données lorsque votre serveur [webhook](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) manque des événements — que ce soit en raison de déconnexions plus longues que la [fenêtre de nouvelle tentative](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries), ou dans des scénarios de reprise après sinistre où vous avez besoin de quelques jours pour remettre votre système à l’état normal.

L’API de relecture de l’activité de compte a été conçue pour toute situation où vous n’ingérez pas d’[activités](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity) pendant une période donnée. Elle livre les activités au même webhook utilisé pour leur diffusion initiale en temps réel. Ce produit est un outil de récupération et non un outil de remplissage rétroactif, ce qui signifie que les événements ne seront rejoués que si une tentative de livraison précédente a eu lieu. L’API de relecture de l’activité de compte ne peut pas livrer d’événements pour une période antérieure à la date de création d’un abonnement.

<div id="using-account-activity-replay-api">
  ### Utilisation de l’API Account Activity Replay
</div>

Si votre compte est configuré avec la fonctionnalité Replay, vous pouvez effectuer des requêtes de manière similaire à celles adressées à l’API Account Activity. Il est important de noter que votre requête doit spécifier un paramètre webhook id pour indiquer les activités du webhook que vous souhaitez rejouer. En d’autres termes, une requête Replay demande à l’API Account Activity Replay de récupérer des événements d’une date et heure de début à une date et heure de fin, sur la base du webhook id et de l’application id.

Veuillez noter que l’heure attendue est en UTC. Ces activités sont livrées via le webhook enregistré associé à l’id à un débit pouvant atteindre 2 500 événements par seconde. Gardez également à l’esprit qu’un seul job Replay par webhook peut être en cours d’exécution à la fois, bien que tous les abonnements qui étaient actifs durant la date/heure spécifiée sur ce webhook soient rejoués.

Les événements sont livrés en commençant par la première (la plus ancienne) minute de la période définie, puis en continuant de façon chronologique (autant que possible) jusqu’à la dernière minute. À ce moment-là, Replay enverra un [événement de fin de job](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#job-completed-successfully-message) au webhook. Comme nous procédons de façon chronologique pour la livraison des activités, s’il y a peu ou pas de résultats correspondants près de l’heure de début, il est probable qu’un certain délai s’écoule avant la livraison des premiers résultats.

<div id="limitations">
  ### Limitations
</div>

Replay est conçu comme un outil permettant de récupérer facilement des activités jusqu’à cinq jours en arrière, mais il ne renverra pas d’événements antérieurs à la création d’un abonnement. Par exemple, si vous avez ajouté un nouvel abonnement il y a trois jours et lancé une tâche Replay avec une fenêtre couvrant les cinq jours précédant aujourd’hui, vous ne recevriez des données que pour les trois jours durant lesquels ce nouvel abonnement a été actif.

<div id="data-availability-and-types">
  ### Disponibilité et types de données
</div>

Les activités de l’API Account Activity Replay sont disponibles pendant cinq jours à compter de l’initiation de la requête, avec de nouvelles données généralement disponibles environ 10 minutes après la création d’une activité donnée. Vous pourrez effectuer des requêtes en spécifiant une plage temporelle dans cette fenêtre de cinq jours à l’aide des paramètres from_date et to_date dans la requête. Les événements initialement livrés avant d’avoir accès à Replay ne peuvent pas être rejoués. Par exemple, si votre compte a été activé pour l’accès à l’API Account Activity Replay le 1er juin 2019 à 15:30 UTC, vous ne pourrez pas utiliser Replay pour récupérer des événements antérieurs à cette date et heure.

Continuer vers la [référence de l’API Account Activity Replay](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated)

<div id="migration-introduction">
  ## Introduction à la migration
</div>

**Nous avons mis fin, en 2018, aux produits Site Streams, User Streams et à la version bêta standard de l’Account Activity API — DM Only. Si vous utilisiez ces produits, veuillez migrer vers la version Premium ou Enterprise de l’Account Activity API.**

**Nous avons également retiré les anciens endpoints de messages privés. Si vous utilisiez ces endpoints, veuillez migrer soit vers les nouveaux endpoints DM, soit vers la version Premium ou Enterprise de l’Account Activity API.**

**Veuillez consulter [cette annonce](https://devcommunity.x.com/t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746) pour en savoir plus.**

Voici les endpoints concernés par ces changements :

* User Streams
* Site Streams
* GET direct_messages
* GET direct_messages/sent
* GET direct_messages/show
* POST direct_messages/new
* POST direct_messages/destroy
   

Nous proposons de nouveaux endpoints et services offrant un accès similaire et, pour les messages privés, des fonctionnalités supplémentaires :

* Account Activity API [Enterprise](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) et [Premium](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index)
* [GET direct_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events)
* [GET direct_messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event)
* [POST direct_messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event)
* [POST direct_messages/events/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event)

Pour vous aider à migrer en douceur vers ces nouveaux endpoints et services, nous proposons deux guides de migration :

* [Guide de migration de l’Account Activity API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#migration-guide-moving-from-user-streams-site-streams-to-account-activity-api) pour ceux qui passent de User Streams et Site Streams à notre nouveau service basé sur des webhooks
* [Guide de migration des messages privés](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/direct-message-migration) pour ceux qui migrent entre les endpoints REST des messages privés
   

Nous proposons également une [série de vidéos](https://www.youtube.com/playlist?list=PLFKjcMIU2WshGG6Yj940XM7Z6BFs1zfBg) sur l’Account Activity API et la prise en main.

Enfin, nous mettons à disposition des exemples de code pour approfondir votre compréhension et vous aider à démarrer rapidement :

* Le [Account Activity Dashboard](https://github.com/xdevplatform/Account-Activity-dashboard) est une application web Node.js d’exemple avec des scripts utilitaires pour démarrer avec l’Account Activity API.
* [SnowBot](https://github.com/xdevplatform/SnowBotDev) est un chatbot d’exemple utilisant l’Account Activity API et les endpoints REST de messages privés. Il est écrit en Ruby, utilise le framework web Sinatra et est déployé sur Heroku.

<div id="migration-guide-moving-from-user-streamssite-streams-to-account-activity-api">
  ## Guide de migration : passer de User Streams/Site Streams à l’Account Activity API
</div>

**Depuis le 23 août 2018, nous avons retiré Site Streams et User Streams. Veuillez migrer vers l’Account Activity API.**

**Veuillez consulter [cette annonce](https://devcommunity.x.com/t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746) pour en savoir plus.**

Ce guide est conçu pour vous aider à migrer des anciennes API User Streams et Site Streams vers leur remplaçante, l’Account Activity API. Vous trouverez ci-dessous un récapitulatif des changements, une liste des nouvelles fonctionnalités, ainsi que les principales différences et points d’attention pour faciliter la transition. Pour obtenir des conseils sur la migration à partir des endpoints DM de base, veuillez vous référer au [guide de migration des Direct Messages](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/direct-message-migration).

<div id="summary-of-changes">
  ### Résumé des modifications
</div>

L&#39;API Account Activity vous enverra des événements pour les comptes authentifiés et abonnés via des webhooks, plutôt que par une connexion de streaming comme avec User Streams et Site Streams.

<div id="deprecated-apis">
  #### API obsolètes
</div>

GET user

GET site (y compris les flux de contrôle : GET site/c/:stream_id, GET site/c/:stream_id/info.json, GET site/c/:stream_id/friends/ids.json, POST site/c/:stream_id/add_user.json, POST /site/c/:stream_id/remove_user.json)

<div id="replacement-apis">
  #### API de substitution
</div>

[Enterprise Account Activity API - Toutes les activités](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api)

<div id="differences-migration-considerations">
  ### Différences et considérations de migration
</div>

**Format de l’API :** La nouvelle Account Activity API fonctionne différemment de User Streams et de Site Streams. Vous devrez modifier votre application web pour recevoir les données via des webhooks. Vous trouverez plus d’informations sur les webhooks [ici](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).

**Données disponibles :** Une autre différence clé concerne les données délivrées. X n’enverra plus d’événements provenant des personnes que vous suivez sur X (votre fil d’accueil). Il s’agit d’un changement intentionnel que nous n’avons pas l’intention de modifier à l’avenir.

**Fiabilité :** Contrairement au streaming, les webhooks permettent de confirmer la livraison et d’effectuer de nouvelles tentatives pour les activités envoyées en POST qui n’atteignent pas l’URL du webhook. Cela offre une meilleure garantie que l’application reçoit toutes les activités pertinentes, même en cas de brèves déconnexions ou de périodes d’indisponibilité.

<div id="new-features">
  ### Nouvelles fonctionnalités
</div>

L’API Account Activity introduit de nombreuses nouveautés, notamment la livraison des données via des webhooks plutôt que par streaming. Les webhooks présentent de nombreux avantages par rapport au streaming, les principaux étant la rapidité et la fiabilité. L’API vous enverra des données sous forme d’événements JSON dès qu’elles seront disponibles, et vous n’aurez plus besoin de maintenir une connexion active ni d’interroger le point de terminaison. Cela réduit le besoin de redondance et améliore l’efficacité globale. Pour en savoir plus sur les webhooks, consultez la [documentation technique](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).

<div id="managing-user-subscriptions">
  ### Gestion des abonnements utilisateur
</div>

L’API Account Activity autorise plusieurs abonnements pour un même webhook enregistré. Cela permet d’acheminer les activités d’abonnement de plusieurs utilisateurs vers un même point de terminaison, à la manière de l’architecture Site Streams, mais via des webhooks. Vous pouvez ainsi suivre les abonnements — au regard de vos limites d’abonnement — indépendamment de la connexion du webhook. Cela facilite également la montée en charge, en passant d’un ou de quelques abonnements à des milliers pour un seul webhook.

<div id="how-to-migrate">
  ### **Procédure de migration**
</div>

<div id="follow-the-steps-below-to-easily-migrate-from-the-site-streams-api-to-the-account-activity-api">
  ### **Suivez les étapes ci-dessous pour migrer facilement de l’API Site Streams vers l’API Account Activity**
</div>

**Étape 1 : Choisir une offre**

Selon la façon dont vous utilisez actuellement User Streams ou Site Streams, envisagez de passer à la version Enterprise ou Premium de l’API Account Activity. Tenez compte du nombre d’applications ou d’utilisateurs autorisés que vous prenez en charge et dimensionnez en fonction du volume et du niveau de fiabilité requis. Pour choisir l’offre la plus adaptée à vos besoins, prenez notamment en considération :

* Nombre de webhooks nécessaires
* Abonnements/utilisateurs autorisés actuels/prévus gérés par votre application
* Nombre actuel d’applications clientes X
* Niveau de support souhaité de la part de X (support via forum ou support Enterprise géré en 1:1)
* Prix de chaque offre

**Étape 2 :** **Vérifier la configuration de votre application X dans le portail développeur**

L’[application X](/fr/resources/fundamentals/developer-apps) actuellement utilisée pour User Streams ou Site Streams sera répertoriée pour l’utilisateur propriétaire dans le [portail développeur](/fr/resources/fundamentals/developer-portal). Cette application X peut également être utilisée avec l’API Account Activity afin de conserver les utilisateurs autorisés de cette application. Vous pouvez aussi créer une nouvelle application, puis faire réautoriser les utilisateurs pour cette nouvelle application si vous le souhaitez. Si vous créez une nouvelle application pour le compte d’une entreprise, il est recommandé de la créer à l’aide d’un compte X @handle d’entreprise.

* Activez « Read, Write and Access direct messages » dans l’onglet [permissions](/fr/resources/fundamentals/developer-apps#app-permissions) de la page de votre application X. 
  *Notez que la modification de ces paramètres n’est pas rétroactive ; tout utilisateur déjà autorisé conservera les autorisations en vigueur au moment où il a été autorisé. Si un utilisateur ne vous a pas encore accordé l’accès en lecture, écriture et aux messages privés, vous devrez lui demander de réautoriser votre application.*
* Si vous ne connaissez pas [X Sign-in](/fr/resources/fundamentals/authentication#log-in-with-x) ni le fonctionnement des contextes utilisateur avec l’API X, consultez [Obtaining Access Tokens](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).
* Générez des jetons d’accès pour le propriétaire de l’application X en bas de l’onglet « Keys and Tokens ». Sur ce même onglet, relevez votre Consumer Key, Consumer Secret, Access Token et Access Token Secret. Vous en aurez besoin pour utiliser l’API.
* Générez un bearer token à l’aide de votre Consumer Key et de votre Consumer Secret pour les méthodes d’API [application-only](/fr/resources/fundamentals/authentication#bearer-token-also-known-as-app-only).

**Étape 3 : Configurer vos webhooks**

* Créez une application web avec un endpoint à utiliser comme webhook pour recevoir des événements (par ex. https://your_domain.com/webhook/twitter ou https://webhooks.your_domain.com).

* Utilisez votre Consumer Key, Consumer Secret, Access Token et Access Token Secret lors de la création de votre webhook. Notez que votre endpoint doit renvoyer une réponse JSON avec un response_token qui est un hachage HMAC SHA-256 encodé en base64, créé à partir du crc_token et du Consumer Secret de votre application.

* Consultez la documentation [Securing Webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks) en prêtant une attention particulière aux exigences du Challenge Response Check (CRC).

* Assurez-vous que votre webhook prend en charge les requêtes POST pour les événements entrants et les requêtes GET pour le CRC.

* Assurez-vous que votre webhook présente une faible latence (&lt; 3 secondes pour répondre aux requêtes POST)

**Étape 4 : Valider la configuration de votre webhook**

* Les API de webhook sécurisent vos webhooks de deux manières :

               - Exiger un challenge response check pour valider que le propriétaire du webhook est bien le propriétaire de l’application web.

               - Inclure un en-tête de signature dans chaque requête POST pour permettre à votre application web de valider la source.

* Afin de vérifier que vous êtes à la fois le propriétaire de l’application web et de l’URL du webhook, X effectuera un Challenge Response Check (CRC), à ne pas confondre avec un contrôle de redondance cyclique.
* Une requête GET avec un paramètre nommé crc_token sera envoyée à l’URL de votre webhook. Votre endpoint doit renvoyer une réponse JSON avec un response_token qui est un hachage HMAC SHA-256 encodé en base64, créé à partir du crc_token et du Consumer Secret de votre application.
* Le crc_token doit être considéré comme susceptible de changer à chaque requête CRC entrante. Le crc_token doit être utilisé comme message dans le calcul, où votre Consumer Secret sert de clé.
* Si la réponse est invalide, les événements cesseront d’être envoyés au webhook enregistré.

**Étape 5 : Créer des abonnements pour chaque utilisateur autorisé de User Streams ou Site Streams**

Passage à l’API Account Activity depuis User Streams :

* Générez la liste de vos abonnements utilisateur actuels sur User Streams
* Configurez vos nouveaux abonnements à l’Account Activity API avec la requête : *POST account_activity/all/:env_name/subscriptions*
* Confirmez vos abonnements à l’Account Activity API avec la requête : *GET account_activity/all/:env_name/subscriptions/list*

Conversion vers l’Account Activity API depuis Site Streams (en utilisant des flux de contrôle) :

* Générez la liste de vos abonnements actuels sur Site Streams avec la requête : *GET /1.1/site/c/:stream_id/info.json*
* Configurez vos nouveaux abonnements à l’Account Activity API avec la requête : *POST account_activity/all/:env_name/subscriptions*
* Confirmez vos abonnements à l’Account Activity API avec la requête : *GET account_activity/all/:env_name/subscriptions/list*

Enregistrement d’un webhook et création d’abonnements (hors migration depuis Site Streams ou User Streams)

* Enregistrez l’URL de votre webhook auprès de votre application avec [POST webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) et recevez un webhook_id.
* Utilisez le webhook_id renvoyé pour ajouter des abonnements utilisateur avec [POST webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all).

<div id="the-account-activity-dashboard-sample-account-activity-api-application">
  ### Le tableau de bord Account Activity (application d’exemple de l’API Account Activity)
</div>

Nous avons créé une application d’exemple pour accélérer un peu les tests de l’API Account Activity :

* Téléchargez l’application d’exemple Account Activity Dashboard [ici](https://github.com/xdevplatform/Account-Activity-dashboard) (elle utilise Node.js)
* Suivez les instructions du README pour installer et lancer l’application
* Une fois l’application lancée, vous pouvez utiliser l’interface pour configurer facilement votre webhook et créer un nouvel abonnement

<div id="available-activities">
  ### Activités disponibles
</div>

| Type de message | Détails |
| :--- | :--- |
| [tweet_create_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#tweet-create-events-posts-retweets-replies-quotetweets) | Charge utile de publication de statut lorsqu’une des actions suivantes est effectuée par ou à l’égard de l’utilisateur abonné : publications, retweets, réponses, @mentions, citations de posts |
| [favorite_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#favorite-events) | Événement « Ajouter aux favoris » (like) avec l’utilisateur et la cible. |
| [follow_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#follow-events) | Événement de suivi avec l’utilisateur et la cible. |
| [block_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#block-events) | Événement de blocage avec l’utilisateur et la cible. |
| [mute_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#mute-events) | Événement de mise en sourdine avec l’utilisateur et la cible. |
| [direct_message_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-events) | Événement de message privé avec l’utilisateur et la cible. |
| [direct_message_indicate_typing_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-indicate-typing-events) | Événement « saisie en cours » pour les messages privés avec l’utilisateur et la cible. |
| [direct_message_mark_read_events](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#direct-message-mark-read-events) | Événement de lecture de message privé avec l’utilisateur et la cible. |

### Types de messages de diffusion obsolètes 

|     |     |
| :--- | :--- |
| Lignes vides | Les lignes vides ne seront plus envoyées via l’Account Activity API, car elles servaient de messages de maintien de connexion dans User Streams et Site Streams. |
| Avis de limitation | Les avis de limitation ne seront plus envoyés à un webhook donné. À la place, les utilisateurs peuvent interroger l’API pour connaître l’utilisation actuelle des handles disponibles. Cette information sera intégrée au portail développeur ultérieurement. |
| Messages de déconnexion | Les avis de déconnexion ne seront plus nécessaires, car les webhooks ne reposent pas sur une connexion active. |
| Avertissements de saturation | Les avertissements de saturation ne seront plus nécessaires, car les webhooks ne dépendent pas d’une connexion active capable de gérer un grand nombre de messages entrants. |
| Liste d’amis | Les listes d’amis ne seront plus envoyées de manière proactive. Un endpoint REST permettra désormais d’obtenir ces informations. |

<div id="deprecated-event-types">
  ### Types d’événements obsolètes
</div>

|     |     |     |     |     |
| :--- | :--- | :--- | :--- | :--- |
| **Description** | **Nom de l’événement** | **Source** | **Cible** | **Objet cible** |
| L’utilisateur supprime une publication | delete | Utilisateur actuel | Utilisateur actuel | Publication |
| Un utilisateur suivi supprime une publication | delete | Utilisateur suivi | Utilisateur suivi | Publication |
| L’utilisateur retire son favori d’une publication | unfavorite | Utilisateur actuel | Auteur de la publication | Publication |
| La publication de l’utilisateur n’est plus en favori | unfavorite | Utilisateur retirant le favori | Utilisateur actuel | Publication |
| L’utilisateur se désabonne de quelqu’un | unfollow | Utilisateur actuel | Utilisateur suivi | Null |
| L’utilisateur crée une liste | list_created | Utilisateur actuel | Utilisateur actuel | Liste |
| L’utilisateur supprime une liste | list_destroyed | Utilisateur actuel | Utilisateur actuel | Liste |
| L’utilisateur modifie une liste | list_updated | Utilisateur actuel | Utilisateur actuel | Liste |
| L’utilisateur ajoute quelqu’un à une liste | list_member_added | Utilisateur actuel | Utilisateur ajouté | Liste |
| L’utilisateur est ajouté à une liste | list_member_added | Utilisateur ajoutant | Utilisateur actuel | Liste |
| L’utilisateur retire quelqu’un d’une liste | list_member_removed | Utilisateur actuel | Utilisateur retiré | Liste |
| L’utilisateur est retiré d’une liste | list_member_removed | Utilisateur retirant | Utilisateur actuel | Liste |
| L’utilisateur s’abonne à une liste | list_user_subscribed | Utilisateur actuel | Propriétaire de la liste | Liste |
| La liste de l’utilisateur reçoit un abonnement | list_user_subscribed | Utilisateur s’abonnant | Utilisateur actuel | Liste |
| L’utilisateur se désabonne d’une liste | list_user_unsubscribed | Utilisateur actuel | Propriétaire de la liste | Liste |
| La liste de l’utilisateur perd un abonnement | list_user_unsubscribed | Utilisateur se désabonnant | Utilisateur actuel | Liste |
| L’utilisateur met à jour son profil | user_update | Utilisateur actuel | Utilisateur actuel | Null |
| L’utilisateur met à jour son statut protégé | user_update | Utilisateur actuel | Utilisateur actuel | Null |

<div id="direct-message-migration-guide">
  ## Guide de migration des Messages privés
</div>

**Le 17 septembre 2018, nous avons retiré les anciens endpoints des Messages privés.
Si vous utilisiez ces endpoints, veillez à migrer vers les nouveaux endpoints des Messages privés ou vers l’Account Activity API.**

**Veuillez consulter [cette annonce](https://devcommunity.x.com//t/details-and-what-to-expect-from-the-api-deprecations-this-week-on-august-16-2018/110746) pour en savoir plus.**

Ce guide est conçu pour vous aider à migrer des anciennes API REST des Messages privés vers leurs remplaçants améliorés, qui ont quitté la phase bêta. Vous trouverez ci-dessous un résumé des changements, une liste des nouvelles fonctionnalités, ainsi que les principales différences et considérations pour faciliter la transition. Les nouveaux endpoints des Messages privés sont désormais disponibles pour tous les développeurs. Pour obtenir des conseils sur la migration depuis User Streams ou Site Streams, consultez le [guide de migration vers l’Account Activity API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#migration-guide-moving-from-user-streams-site-streams-to-account-activity-api).

* [Résumé des changements](#summary)
* [Nouvelles fonctionnalités](#features)
* [Envoi de Messages privés](#sending)
* [Réception de Messages privés](#receiving)
* [Suppression de Messages privés](#deleting)

<div id="summary-of-changes">
  ### Récapitulatif des modifications
</div>

Si vous utilisez encore les endpoints DM suivants, vous devrez migrer vers les endpoints plus récents.

| Endpoint obsolète | Nouvelle alternative de migration |
| :--- | :--- |
| [POST direct_messages/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) | [POST direct_messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) |
| [GET direct_messages/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) | [GET direct_messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) |
| [GET direct_messages](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) | [GET direct_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) |
| [GET direct_messages/sent](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) | [GET direct_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) |
| [POST direct_messages/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event) | [DELETE direct_messages/events/destroy](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/delete-message-event) |

<div id="new-features">
  ### Nouvelles fonctionnalités
</div>

Les nouveaux endpoints de l’API Direct Message prennent en charge plusieurs nouvelles fonctionnalités et offrent un meilleur accès aux anciens messages privés. Les nouveautés incluent :

* Prise en charge des pièces jointes média (images, GIF et vidéos).
* Possibilité de proposer aux utilisateurs des réponses structurées à partir d’une liste d’options prédéfinies.
* Accès aux messages privés des 30 derniers jours.

Pour la liste complète des nouvelles fonctionnalités des messages privés et des nouveaux endpoints d’API, consultez la [documentation technique](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/overview).
 

<div id="differences-migration-considerations">
  ### Différences et considérations liées à la migration
</div>

Les nouveaux endpoints de l’API se comportent très différemment de leurs précédentes versions. Se contenter de mettre à jour les URL des endpoints entraînera des erreurs dans votre application. Tenez compte des points suivants lors de la mise à jour de votre application pour la migration.

<div id="new-direct-message-object">
  #### Nouvel objet Direct Message
</div>

La première chose que vous remarquerez probablement est la nouvelle structure d’objet des Direct Messages. Cette nouvelle structure d’objet Message Create a été introduite pour prendre en charge de nouvelles fonctionnalités comme les [Quick Replies](https://developer.x.com/en/docs/x-api/v1/direct-messages/quick-replies/overview) et les [Attachments](https://developer.x.com/en/docs/x-api/v1/direct-messages/message-attachments/overview). Le nouvel objet inclut également un objet utilisateur plus condensé. Votre application devra être mise à jour pour tenir compte de cette nouvelle structure d’objet lors de l’analyse et, potentiellement, dans les modèles de données ou le stockage. Pour la description de chaque propriété, consultez la [documentation complète sur le Message Create Object](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/guides/message-create-object).

**Exemple d’objet Message Create**

```json
{
      "type": "message_create",
      "id": "1234858592",
      "created_timestamp": "1392078023603",
      "initiated_via": {
        "tweet_id": "123456",
        "welcome_message_id": "456789"
      },
      "message_create": {
        "target": {
          "recipient_id": "1234858592"
        },
        "sender_id": "3805104374",
        "source_app_id": "268278",
        "message_data": {
          "text": "Blue Bird",
          "entities": {
            "hashtags": [],
            "symbols": [],
            "urls": [],
            "user_mentions": []
          },
          "quick_reply_response": {
            "type": "options",
            "metadata": "external_id_2"
          },
          "attachment": {
            "type": "media",
            "media": {
             ...
            }
          }
        }
      }
```

<div id="summary">
  #### Résumé
</div>

* Nouvelle structure entièrement repensée de l’objet Direct Message.
* Objet utilisateur simplifié.
* Nouvelles informations disponibles (réponses aux quick replies, pièces jointes, etc.).

<div id="sending-direct-messages">
  ### Envoi de messages privés
</div>

[POST direct_messages/events/new](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/new-event) remplace directement l’envoi de messages privés. La différence principale avec cet endpoint est que toutes les informations sont désormais envoyées en JSON dans le corps de la requête POST, et non plus sous forme de paramètres POST individuels.

**Exemple de requête twurl**

```bash
twurl -A 'Content-type: application/json' -X POST /1.1/direct\_messages/events/new.json -d '{"event": {"type": "message\_create", "message\_create": {"target": {"recipient\_id": "4534871"}, "message_data": {"text": "Hello World!"}}}}'
```

Notez dans la requête ci-dessus que le Content-Type est défini sur application/json plutôt que sur application/x-www-form-urlencoded. Par ailleurs, si vous construisez la signature OAuth 1.0a, sachez que le corps JSON n’est pas inclus dans la génération de la signature. La plupart des bibliothèques OAuth en tiennent déjà compte. Si vous utilisez [twurl](https://github.com/twitter/twurl), assurez-vous d’utiliser au moins la version 0.9.3.

<div id="summary">
  #### Résumé
</div>

* Le message est défini dans le corps de la requête POST au format JSON
* L’en-tête Content-Type doit être défini sur application/json
* Le corps JSON n’est pas inclus dans le calcul de la signature OAuth.
   

<div id="retrieving-direct-messages">
  ### Récupération des Messages Privés
</div>

La récupération des anciens Messages Privés s’effectue désormais via un unique endpoint d’API : [GET direct_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events). La grande nouveauté de cet endpoint est qu’il renvoie à la fois les messages envoyés et reçus, par ordre antichronologique. Cela peut faciliter la reconstitution d’une conversation. Cependant, si vous ne souhaitez récupérer que les messages envoyés ou reçus, vous devrez post-traiter la réponse en vous référant à la propriété sender_id.

La pagination est désormais basée sur une valeur de curseur plutôt que sur l’ID d’un Message Privé. Une propriété cursor est renvoyée avec chaque réponse. [GET direct_messages/events/list](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/list-events) renvoie jusqu’à 30 jours de messages passés, quel que soit le nombre de messages sur cette période. Lorsqu’aucun curseur n’est renvoyé, il n’y a plus de messages à renvoyer. La méthode d’accès à un Message Privé individuel avec [GET direct_messages/events/show](https://developer.x.com/en/docs/x-api/v1/direct-messages/sending-and-receiving/api-reference/get-event) reste la même, bien que l’objet Message Privé renvoyé ait une structure différente, comme décrit précédemment.

Enfin, l’accès en temps réel aux Messages Privés s’effectue désormais via webhook avec l’[Account Activity API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity). Pour obtenir des conseils sur la migration depuis User Streams ou Site Streams, consultez le guide de migration vers l’Account Activity API pour plus d’informations.

<div id="summary">
  #### Résumé
</div>

* Les messages envoyés et reçus sont désormais renvoyés par le même endpoint.
* Jusqu’à 30 jours de messages renvoyés.
* Pagination basée sur des curseurs.
* Accès en temps réel aux messages privés via webhook.

<div id="deleting-direct-messages">
  ### Suppression des messages privés
</div>

Les messages privés peuvent désormais être supprimés avec DELETE direct_messages/events/destroy. L’interface reste en grande partie identique et nécessite l’ID du message à supprimer. La principale différence est que l’endpoint requiert désormais une requête DELETE au lieu d’une requête POST.

La façon dont les messages privés supprimés s’affichent dans les clients officiels de X reste inchangée. Les messages privés ne sont retirés que de l’interface de l’utilisateur du contexte fourni. Les autres participants à la conversation peuvent toujours accéder au message privé.

<div id="summary">
  #### Résumé
</div>

* La suppression d’un message privé nécessite l’identifiant.
* Le nouvel endpoint requiert une requête DELETE.
* La manière dont les messages privés supprimés s’affichent dans les clients officiels X reste inchangée.

**Des questions sur la migration vers les nouveaux endpoints de messages privés ?**
Publiez votre question sur le forum de la communauté des développeurs sur [devcommunity.com](https://devcommunity.x.com/).

<div id="frequently-asked-questions">
  ## Foire aux questions
</div>

<div id="general">
  ### Général
</div>

**Quels sont les avantages de l’Account Activity API ?**

L’Account Activity API utilise des webhooks : contrairement aux APIs de streaming, vous n’avez pas besoin de maintenir une connexion ouverte pour que nous vous envoyions des informations. Les webhooks diffèrent aussi des APIs REST, car vous n’avez pas à nous interroger des centaines de fois toutes les 15 minutes pour obtenir les données qui vous intéressent. Cela améliore l’efficacité entre l’utilisateur et votre application, car les données sont livrées en temps réel.

L’Account Activity API présente plusieurs avantages :

1. **Vitesse** : nous livrons les données à la vitesse de X.
2. **Simplicité** : nous livrons tous les événements d’un compte via une seule connexion webhook. Les activités envoyées via l’API incluent les Posts, @mentions, réponses, Retweets, Tweets cités, Retweets de Tweets cités, favoris, Direct Messages envoyés, Direct Messages reçus, abonnements, blocages, masquages.
3. **Évolutivité** : vous recevez toutes les activités d’un compte que vous gérez sans être limité par des plafonds de taux ou d’événements.

L’Account Activity API est proposée en sandbox premium, premium payant et offre enterprise, ce qui vous permet de monter en charge à mesure que vous avez besoin de plus de comptes pour des fonctionnalités de conformité ou des fonctionnalités supplémentaires.

Pour commencer, téléchargez des extraits de code d’exemple depuis [GitHub](https://github.com/xdevplatform/account-activity-dashboard).
 

**Comment identifier quel niveau de produit me convient le mieux ?**

Veuillez consulter notre page [Vue d’ensemble de l’Account Activity API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity) pour en savoir plus sur les différences entre les options Premium et l’option Enterprise.
 

**Quelle est la différence entre un environnement Premium et un webhook Enterprise ?**

Aucune. Chaque environnement Premium a son propre webhook_id.
 

**J’ai besoin d’environnements de développement, de préproduction et de production pour l’Account Activity API, est-ce possible ?**

Oui ! Avec les niveaux payants de l’Account Activity API (Premium payant et Enterprise), il est possible d’enregistrer plusieurs URL de webhook et de gérer les abonnements séparément pour chacun via les méthodes de l’API. En outre, plusieurs applications clientes peuvent être ajoutées à une allowlist pour conserver l’autorisation de vos utilisateurs déjà autorisés.
 

**Avez-vous des guides pas à pas pour configurer l’Account Activity API ?**

Absolument !

* Si vous débutez, nous vous recommandons de consulter notre guide [Bien démarrer avec les webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks)

* Suivez nos scripts pris en charge par X Dev :
  * [Account Activity API dashboard](https://github.com/xdevplatform/account-activity-dashboard), une application web Node qui affiche les événements webhook.
  * Le [chatbot SnowBot](https://github.com/xdevplatform/SnowBotDev), une application web Ruby basée sur les APIs Account Activity et Direct Message. Cette base de code inclut un [script](https://github.com/xdevplatform/SnowBotDev/wiki/Account-Activity-API-setup-script) pour aider à configurer les webhooks de l’Account Activity API.
     

**Existe-t-il un moyen de récupérer les données si notre système est indisponible pendant un certain temps ?**

Avec les niveaux payants de l’Account Activity API (Premium payant et Enterprise), notre système [réessaie](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) de vous envoyer les activités plusieurs fois sur une période de quatre heures. Si votre système ne répond pas dans ce délai, l’activité sera perdue et vous devrez utiliser d’autres endpoints REST pour récupérer les données dans un délai de 7 jours.

Nous vous suggérons d’utiliser vos différents webhooks, ou environnements, comme mécanisme de redondance, ainsi que l’[Account Activity Replay API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-replay-api), afin de vous assurer que vous ne manquiez aucune activité si l’un de vos systèmes tombe en panne.
 

**Quelle authentification dois-je utiliser avec l’Account Activity API ?**

Les méthodes d’autorisation requises pour l’Account Activity API sont décrites, méthode par méthode, dans les [pages de référence de l’API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#account-activity-api-reference-index). Si vous débutez avec l’authentification X, nous vous recommandons de lire [cette section](/fr/resources/fundamentals/authentication).

**Qu’est-ce qu’un contrôle challenge-response (CRC) ?**

La vérification de la réponse au défi (CRC) de l’Account Activity API est une fonctionnalité de sécurité mise en place pour garantir que les activités de l’Account Activity API sont envoyées au bon développeur. Elle peut également être utilisée par les développeurs pour s’assurer que les données qu’ils reçoivent proviennent de X. X enverra automatiquement un CRC à votre URL de webhook toutes les 24 heures, à compter de la dernière validation de l’URL de webhook. Votre système doit répondre avec une réponse valide en moins de 3 secondes pour rester validé.

Veuillez consulter notre page [Securing webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#securing-webhooks) pour plus de détails.

**Y a-t-il quelque chose qui invaliderait immédiatement mon URL de webhook ?**

Si l’un des éléments suivants se produit, nous marquerons immédiatement votre webhook comme invalide :

* Le serveur répond à un CRC avec un jeton incorrect. Dans ce cas, notre système ne [réessaiera](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) pas de vous envoyer l’activité.
* L’URL du webhook a un certificat incorrectement configuré. Dans ce cas, notre système ne [réessaiera](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#retries) pas de vous envoyer l’activité.
* Votre serveur renvoie un code de réponse autre que 2XX, 4XX ou 5XX.
* Vous indiquez l’utilisation de gzip sans réellement l’envoyer.
* Vous n’indiquez pas l’utilisation de gzip, mais vous l’envoyez dans la réponse.

**Vais-je recevoir des activités en double si je suis abonné à des utilisateurs qui interagissent entre eux ?**

Oui. Si votre application web a des abonnements actifs pour l’utilisateur A et l’utilisateur B, et que l’utilisateur A mentionne l’utilisateur B dans une publication, deux activités POST seront envoyées au webhook enregistré. Chaque activité comportera un indicateur « for_user_id » indiquant à quel abonnement l’activité appartient.

**Lorsque je crée un abonnement à mon webhook, puis-je remplacer la partie `/all/` de l’endpoint suivant par d’autres objets de données d’activité de compte pour limiter les activités que l’API livre ?**`POST https://api.x.com/1.1/account_activity/all/:env_name/subscriptions.json`

Non, ce n’est pas possible. À l’heure actuelle, seul le produit `/all/` est disponible.

**Existe-t-il un moyen d’utiliser l’Account Activity API sans demander aux utilisateurs l’autorisation d’accéder aux Messages privés ?**

À ce stade, l’autorisation relative aux Messages privés est requise, car il n’existe aucun moyen d’« exclure » les activités de Messages privés pour cette API.

**Existe-t-il une version gratuite de l’Account Activity API ?**

Oui, nous proposons une version sandbox gratuite. Notre option sandbox est limitée à un seul webhook avec un maximum de 15 abonnements. Vous pouvez en savoir plus sur l’option sandbox dans [notre documentation](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity).

**Est-il possible d’utiliser l’Account Activity API pour obtenir les Retweets de publications qui mentionnent des utilisateurs abonnés ?**

Malheureusement, cela ne fait pas partie des activités livrées par cette API. Pour cela, nous suggérons d’utiliser la Streaming API.

**Quels sont les types d’activité possibles représentés par un tweet_create_event ?**

Un payload tweet_create_event sera envoyé :

Si l’utilisateur abonné effectue l’une des actions suivantes :

* Crée une publication
* Retweete
* Répond à une publication

Si un autre utilisateur :

* @mentionne* l’utilisateur abonné
* Cite un Tweet créé par l’utilisateur abonné

*Remarque : l’Account Activity API ne livre des événements que lorsque l’utilisateur abonné recevrait une notification de X et pourrait voir l’événement publiquement. Cela signifie que, si le compte mentionné (@userA) suit le compte protégé (@userB), alors UserA recevra une notification indiquant que UserB l’a mentionné. Si UserA ne suit pas UserB (et n’a pas été approuvé par UserB), UserA ne recevra pas de notification et, par conséquent, un tweet_create_event ne serait pas envoyé via AAA si @userA avait un abonnement.*

**Si un utilisateur bloqué mentionne mon utilisateur abonné, comment puis-je l’identifier ?**

Vous verrez un champ booléen `user_has_blocked` au niveau supérieur de la réponse JSON, défini sur « true » ou « false ». Ce champ ne sera exposé que pour les mentions de publication.

Enterprise

**Comment puis-je ajouter mon application à une allowlist ou vérifier si mon application est déjà sur l’allowlist ?**

Pour gérer les [applications X](/fr/resources/fundamentals/developer-apps) que vous avez ajoutées à une liste d’autorisation pour l’accès via les API Enterprise, veuillez contacter votre chargé de compte avec l’ID de votre application. Vous pouvez trouver l’ID de votre application en accédant à la page [&quot;Applications&quot;](/fr/resources/fundamentals/developer-apps) dans le [portail développeur](/fr/resources/fundamentals/developer-portal).
 

**Si j’ai accès à trois webhooks, puis-je utiliser trois webhooks pour chacune des applications que j’ai enregistrées pour un usage Enterprise ?**

La limite de webhooks est définie au niveau du compte, et non au niveau de l’application. Si vous avez accès à trois webhooks et deux applications enregistrées pour un usage Enterprise, vous pouvez utiliser deux webhooks sur une application et le troisième sur l’autre, mais pas trois sur chaque application. 

**Puis-je spécifier quels types d’événements seront renvoyés à l’aide de l’API Account Activity Replay ?**

Les types d’événements à rejouer ne peuvent pas être spécifiés. Tous les événements livrés pendant la fenêtre de date et d’heure spécifiée seront rejoués. 

**Y aura-t-il des tentatives de renvoi si mon application ne parvient pas à ingérer un événement de l’API Account Activity Replay ?**

Non, il n’y aura pas de nouvelles tentatives. Si une application ne parvient pas à ingérer un événement envoyé par l’API Account Activity Replay, un autre job de Replay peut être soumis pour la même période afin de tenter la nouvelle livraison des événements de Replay manqués. 

**Que dois-je faire lorsque je reçois un événement d’achèvement avec succès partiel ?**

Nous suggérons de noter les horodatages des événements reçus et de demander un autre job de Replay pour les événements manqués. 

**Combien de jobs de l’API Account Activity Replay puis-je exécuter en même temps ?**

Un seul job de l’API Account Activity Replay par webhook peut être en cours d’exécution à la fois. 

**Comment puis-je différencier les événements de l’API Account Activity Replay des événements de production en temps réel lorsqu’ils sont livrés à mon webhook ?**

Comme l’API Account Activity Replay livre toujours des événements passés, on peut les différencier des événements de production en temps réel à partir de l’horodatage de l’événement. 

**Dans quel délai puis-je commencer à utiliser l’API Account Activity Replay pour renvoyer une activité que mon application a abandonnée ou manquée ?**

Une activité devient disponible pour une nouvelle livraison environ 10 minutes après sa création. 

<div id="error-troubleshooting-guide">
  ### Guide de résolution des erreurs
</div>

<div id="code-32">
  #### Code 32
</div>

Cette erreur indique généralement qu’un élément est mal formé dans la requête, les en-têtes, l’autorisation ou l’URL que vous avez spécifiée. Il ne s’agit pas d’une erreur de l’Account Activity API, mais d’une erreur d’autorisation : X ne reçoit pas la configuration OAuth ou l’URL appropriée.

* **Enterprise** - Assurez-vous que les consumer keys et access tokens que vous utilisez appartiennent à une [application X](/fr/resources/fundamentals/developer-apps) enregistrée pour l’utilisation des produits Enterprise. Si vous ne disposez pas de vos consumer keys et access tokens, ou si vous devez ajouter votre application X à la allowlist, veuillez contacter votre account manager.

* Si vous vous authentifiez avec un contexte utilisateur, assurez-vous d’avoir correctement [autorisé votre requête](/fr/resources/fundamentals/authentication#authorizing-a-request) avec les `oauth_nonce`, `oauth_signature` et `oauth_timestamp` appropriés.

* Assurez-vous que vos access tokens disposent du niveau d’autorisation approprié.
  * Dans l’onglet &quot;Keys and tokens&quot; du [app dashboard](/fr/resources/fundamentals/developer-apps), vérifiez que vos access tokens ont le niveau d’autorisation &quot;Read, write, and direct messages&quot; ([permission level](/fr/resources/fundamentals/developer-apps#app-permissions)).
  * Si le niveau d’autorisation des tokens est inférieur, accédez à l’onglet &quot;Permissions&quot;, définissez le niveau d’accès sur &quot;Read, write, and direct messages&quot;, puis régénérez vos access tokens et secret depuis l’onglet &quot;Keys and tokens&quot;.

* Assurez-vous que votre URL est correctement formée.
  * Gardez à l’esprit que `:env_name` est sensible à la casse.
     

<div id="code-200-forbidden">
  #### Code 200 - Interdit
</div>

* **Premium** - Assurez-vous de disposer d’un [compte développeur](/fr/resources/fundamentals/developer-portal) approuvé avant de tenter d’effectuer une requête vers l’API. Vous devez également utiliser la valeur :env_name appropriée dans la requête, que vous pouvez configurer sur la page [dev environments](/fr/resources/fundamentals/developer-portal).

* **Enterprise** - Assurez-vous que votre gestionnaire de compte vous a accordé l’accès à l’Account Activity API.

* Assurez-vous d’avoir correctement configuré votre URI. Cette erreur peut se produire si vous avez saisi un URI incorrect dans votre requête.
   

<div id="code-214-webhook-url-does-not-meet-the-requirements">
  #### Code 214 - L’URL du webhook ne respecte pas les exigences.
</div>

* Assurez-vous d’utiliser HTTPS.
* L’URL de votre webhook est peut-être mal formée.
* Pour en savoir plus sur la configuration de votre URL de webhook, consultez la section [Develop webhook consumer app](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#3-develop-webhook-consumer-app) de la page [Getting started with webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#getting-started-with-webhooks).
   

<div id="code-214-high-latency-on-crc-get-request-your-webhook-should-respond-in-less-than-3-seconds">
  #### Code 214 - Latence élevée sur la requête GET CRC. Votre webhook doit répondre en moins de 3 secondes.
</div>

* Cela signifie que votre serveur est lent. Assurez-vous de répondre au CRC en moins de 3 secondes.
   

<div id="code-214-non-200-response-code-during-crc-get-request-ie-404-500-etc">
  #### Code 214 - Code de réponse autre que 200 lors de la requête CRC GET (p. ex. 404, 500, etc.).
</div>

* Votre serveur est indisponible. Assurez-vous qu’il fonctionne correctement.
   

<div id="code-214-too-many-resources-already-created">
  #### Code 214 - Trop de ressources déjà créées.
</div>

* **Enterprise** - Vous avez déjà utilisé tous vos webhooks. Utilisez le point de terminaison [GET webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) avec chacune de vos applications enregistrées pour identifier où vos webhooks sont déployés. 

<div id="code-261-application-cannot-perform-write-actions">
  #### Code 261 - L’application ne peut pas effectuer d’actions d’écriture.
</div>

* L’app que vous utilisez avec l’API n’a pas le [niveau d’autorisation](/fr/resources/fundamentals/developer-apps#app-permissions) approprié configuré pour son access token et son access token secret. Accédez à l’onglet « Keys and tokens » dans le tableau de bord [X apps](/fr/resources/fundamentals/developer-apps) et vérifiez les niveaux d’autorisation attribués à votre access token et à votre access token secret. S’il est défini sur autre chose que « Read, write and Direct Messages », vous devrez ajuster les paramètres dans l’onglet « Permission » et régénérer votre access token et votre access token secret pour appliquer les nouveaux paramètres.
* Autrement, vous essayez d’enregistrer un webhook en utilisant l’authentification app-only, ce qui n’est pas pris en charge. Veuillez plutôt vous authentifier avec un contexte utilisateur, comme indiqué dans les sections de référence de l’API sur l’enregistrement d’un webhook pour [Enterprise Account Activity API](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks).

<div id="account-activity-api-reference-index">
  ## Index de référence de l’API Account Activity
</div>

|     |     |
| :--- | :--- |
| **Public visé** | Enterprise |
| Enregistre une URL de webhook / Génère un webhook_id | [POST  <br />webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#enterprise-account-activity-api) |
| Renvoie toutes les URL de webhook et leur état | [GET  <br />webhooks](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks) |
| Déclenche manuellement une vérification de challenge (CRC) | [PUT  <br />webhooks/:webhook_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#put-account-activity-webhooks-webhook-id) |
| Abonne une application aux événements d’un compte | [POST  <br />webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#post-account-activity-webhooks-webhook-id-subscriptions-all) |
| Renvoie le nombre d’abonnements actifs | [GET  <br />subscriptions/count](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| Vérifie si un webhook est abonné à un compte | [GET  <br />webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-webhooks-webhook-id-subscriptions-all) |
| Renvoie la liste des abonnements actifs | [GET  <br />webhooks/:webhook_id/subscriptions/all/list](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#get-account-activity-subscriptions-count) |
| Supprime le webhook | [DELETE  <br />webhooks/:webhook_id](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id) |
| Désactive un abonnement via OAuth en 3 étapes (DÉPRÉCIÉ) | [DELETE  <br />webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) |
| Désactive un abonnement via OAuth « application-only » | [DELETE  <br />webhooks/:webhook_id/subscriptions/:user_id/all.json](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json) |
| Reroute les activités vers un webhook | [POST  <br />replay/webhooks/:webhook_id/subscriptions/all](/fr/x-api/enterprise-gnip-2.0/fundamentals/account-activity#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated) |

<div id="enterprise-account-activity-api">
  ### API Enterprise Account Activity
</div>

<div id="post-account_activitywebhooks">
  #### POST account_activity/webhooks[](#post-account-activity-webhooks "Permalink to this headline")
</div>

Enregistre une nouvelle URL de webhook pour le contexte d’application spécifié. L’URL est validée via une requête CRC avant l’enregistrement. En cas d’échec de la validation, un message d’erreur détaillé est renvoyé au demandeur.

Le nombre de webhooks autorisés est déterminé par l’offre de facturation.

<div id="resource-url">
  ### URL de ressource[](#resource-url "Permalink to this headline")
</div>

`https://api.x.com/1.1/account_activity/webhooks.json`

<div id="resource-information">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (contexte utilisateur – tous les jetons consommateur et d’accès) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 min (authentification utilisateur) | 15 |
| Prise en charge des modifications de Tweets | Tous les objets Tweet incluront des métadonnées d’édition décrivant l’historique des modifications du Tweet. Consultez la page consacrée aux [« modifications de Tweets »](/fr/x-api/enterprise-gnip-2.0/fundamentals/edit-tweets) pour plus de détails. |

<div id="parameters">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| url (obligatoire) | URL encodée du point de terminaison de callback. |

<div id="example-request">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

$ curl --request POST
--url &#39;https://api.x.com/1.1/account_activity/webhooks.json?url=https%3A%2F%2Fyour_domain.com%2Fwebhooks%2Ftwitter%2F0&#39;
--header &#39;authorization: OAuth oauth_consumer_key=&quot;CONSUMER_KEY&quot;, oauth_nonce=&quot;GENERATED&quot;, oauth_signature=&quot;GENERATED&quot;, oauth_signature_method=&quot;HMAC-SHA1&quot;, oauth_timestamp=&quot;GENERATED&quot;, oauth_token=&quot;ACCESS_TOKEN&quot;, oauth_version=&quot;1.0&quot;&#39;

<div id="http-responses">
  ### Réponses HTTP[](#http-responses "Permalink to this headline")
</div>

| Code HTTP | Message |
| :--- | :--- |
| 200 | L’URL du webhook est enregistrée pour l’application indiquée |
| 403 | Votre requête comporte une erreur. Voir la section « Messages d’erreur » ci-dessous. |

<div id="example-response-success">
  ### Exemple de réponse - Réussite[](#example-response-success "Permalien vers ce titre")
</div>

```json
_HTTP 200_

    {
      "id": "1234567890",
      "url": "https://your_domain.com/webhook/twitter/0",
      "valid": true,
      "created_at": "2016-06-02T23:54:02Z"
    }
```

<div id="error-messages">
  ### Messages d’erreur[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 214 | L’URL du webhook ne satisfait pas aux exigences. |
| 214 | Trop de ressources déjà créées. |
| 214 | L’URL du webhook ne satisfait pas aux exigences. Jeton CRC invalide ou format de réponse JSON invalide. |
| 214 | Latence élevée sur la requête CRC en GET. Votre webhook doit répondre en moins de 3 secondes. |
| 214 | Code de réponse différent de 200 lors de la requête CRC en GET (p. ex. 404, 500, etc.). |

*HTTP 403*

```json
    {
      "errors": [
        {
          "code": 214,
          "message": "Too many resources already created."
        }
      ]
    }
```

<div id="get-account_activitywebhooks">
  #### GET account_activity/webhooks[](#get-account-activity-webhooks "Permalink to this headline")
</div>

Renvoie toutes les URL et leur statut pour l’application donnée.

Nous marquons une URL comme invalide si elle échoue au contrôle de validation quotidien. Pour réactiver l’URL, appelez le point de terminaison de mise à jour.

<div id="resource-url">
  ### URL de la ressource[](#resource-url "Permalink to this headline")
</div>

`https://api.x.com/1.1/account_activity/webhooks.json`

### Informations sur la ressource[](#resource-information "Lien permanent vers ce titre")

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (application uniquement — jeton Bearer) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 min (authentification d’application) | 15  |

<div id="example-request">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request GET
     --url https://api.x.com/1.1/account_activity/webhooks.json
     --header 'authorization: Bearer TOKEN'
```

<div id="example-response">
  ### Exemple de réponse[](#example-response "Permalink to this headline")
</div>

*HTTP 200 OK*

```json
    [
      {
        "id": "1234567890",
        "url": "https://your_domain.com/webhook/twitter/0",
        "valid": true,
        "created_at": "2016-06-02T23:54:02Z"
      }
      {
        "id": "2468013579",
        "url": "https://your_domain2.com/webhook/twitter/0",
        "valid": true,
        "created_at": "2016-06-04T22:31:29Z"
      }
    ]
```

### Messages d’erreur[](#error-messages "Lien permanent vers ce titre")

| Code | Message |
| :--- | :--- |
| 99  | Vous n’avez pas accès à cette ressource. |

<div id="put-account_activitywebhookswebhook_id">
  #### PUT account_activity/webhooks/:webhook_id[](#put-account-activity-webhooks-webhook-id "Permalink to this headline")
</div>

Déclenche le contrôle de réponse au défi (CRC) pour l’URL du webhook indiqué. Si le contrôle réussit, renvoie 204 et réactive le webhook en définissant son statut sur `valid`.

<div id="resource-url">
  ### URL de la ressource[](#resource-url "Permalink to this headline")
</div>

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id.json`

<div id="resource-information">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (contexte utilisateur – tous les jetons consommateur et d’accès) |
| Soumis à une limitation de débit | Oui |
| Requêtes par fenêtre de 15 min (authentification utilisateur) | 15 |

<div id="parameters">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook_id (obligatoire) | Identifiant du webhook. Défini dans le chemin de la ressource. |

<div id="example-request">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

```json
    $ curl --request PUT
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID.json
     --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="response">
  ### Réponse[](#response "Permalink to this headline")
</div>

*HTTP 204 OK*

```
    { }
```

<div id="error-messages">
  ### Messages d’erreur[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 34  | Le webhook n’existe pas ou est associé à une autre application X. |
| 214 | L’URL du webhook ne satisfait pas aux exigences. |
| 214 | L’URL du webhook ne satisfait pas aux exigences. Jeton CRC invalide ou format de réponse JSON invalide. |
| 214 | Latence élevée sur la requête GET du CRC. Votre webhook doit répondre en moins de 3 secondes. |
| 214 | Code de réponse différent de 200 lors de la requête GET du CRC (p. ex. 404, 500, etc.). |

<div id="post-account_activitywebhookswebhook_idsubscriptionsall">
  #### POST account_activity/webhooks/:webhook_id/subscriptions/all[](#post-account-activity-webhooks-webhook-id-subscriptions-all "Permalien vers ce titre")
</div>

Abonne l’application fournie à tous les événements du contexte utilisateur spécifié, pour tous les types de messages. Après activation, tous les événements de l’utilisateur à l’origine de la requête seront envoyés au webhook de l’application via une requête POST.

Les abonnements sont actuellement limités en fonction de la configuration de votre compte. Si vous devez ajouter davantage d’abonnements, veuillez contacter votre responsable de compte.

<div id="resource-url">
  ### URL de ressource[](#resource-url "Permalink to this headline")
</div>

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-information">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (OAuth à 3 volets - clé consommateur autorisée et jeton d’accès de l’utilisateur abonné) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 min (authentification utilisateur) | 500 |

<div id="parameters">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook_id (obligatoire) | Identifiant du webhook. Défini dans le chemin de ressource. |

<div id="example-request">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request POST
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json
     --header 'authorization: OAuth oauth_consumer_key="WHITELISTED_CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBING_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="example-response-success">
  ### Exemple de réponse – Réussite[](#example-response-success "Permalink to this headline")
</div>

*HTTP 204 SANS CONTENU*

```
    {}
```

<div id="error-messages">
  ### Messages d’erreur[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 34  | Le webhook n’existe pas ou est associé à une autre application X. |
| 348 | L’application cliente n’est pas autorisée à accéder aux abonnements au webhook de cet utilisateur. |

<div id="get-account_activitysubscriptionscount">
  #### GET account_activity/subscriptions/count[](#get-account-activity-subscriptions-count "Permalink to this headline")
</div>

Renvoie le nombre d’abonnements actuellement actifs sur votre compte. Notez que le point de terminaison /count requiert l’authentification OAuth en mode application uniquement ; vous devez donc effectuer vos requêtes à l’aide d’un jeton d’accès (bearer) plutôt qu’en contexte utilisateur.

<div id="resource-url">
  ### URL de la ressource[](#resource-url "Permalink to this headline")
</div>

`https://api.x.com/1.1/account_activity/subscriptions/count.json`

<div id="resource-information">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | Code de réponse HTTP |
| Authentification requise | Oui (application uniquement — jeton Bearer) |
| Soumis à des limites de débit | Oui |
| Requêtes / fenêtre de 15 min (authentification application) | 15  |

<div id="http-response-codes">
  ### Codes de réponse HTTP[](#http-response-codes "Lien permanent vers ce titre")
</div>

|     |     |
| :--- | :--- |
| Code | Message |
| 200 | Succès. Un décompte des abonnements pour le webhook demandé sera renvoyé. |
| 401 | Votre application n’a pas l’autorisation d’afficher les abonnements pour le webhook spécifié. |

### Exemple de requête[](#example-request "Permalien vers ce titre")

```bash
    $ curl --request GET
     --url https://api.x.com/1.1/account_activity/subscriptions/count.json
     --header 'authorization: Bearer TOKEN'
```

<div id="example-response-success">
  ### Exemple de réponse — Succès[](#example-response-success "Permalink to this headline")
</div>

*HTTP 200*

```bash
    {
      "account_name":"my-account",
      "subscriptions_count_all":"1",
      "subscriptions_count_direct_messages":"0",
      "provisioned_count":"50"
    }
```

<div id="error-messages">
  ### Messages d’erreur[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 32  | Échec de votre authentification. |

*HTTP 401*

```abash
    {
      "errors": [
        {
           "code": 32,
          "message": "Could not authenticate you."
        }
      ]
    }
```

<div id="get-account_activitywebhookswebhook_idsubscriptionsall">
  #### GET account_activity/webhooks/:webhook_id/subscriptions/all[](#get-account-activity-webhooks-webhook-id-subscriptions-all "Permalink to this headline")
</div>

Permet de déterminer si une configuration de webhook est abonnée aux événements de l’utilisateur indiqué. Si le contexte utilisateur indiqué a un abonnement actif avec l’application fournie, renvoie 204 OK. Si le code de réponse n’est pas 204, l’utilisateur n’a pas d’abonnement actif. Voir ci-dessous les codes de réponse HTTP et les messages d’erreur pour plus de détails.

<div id="resource-url">
  ### URL de la ressource[](#resource-url "Permalink to this headline")
</div>

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-information">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de la réponse | JSON |
| Authentification requise | Oui (OAuth à 3 volets — clé consommateur autorisée et jeton d’accès de l’utilisateur abonné) |
| Soumis à une limite de débit | Oui |
| Requêtes / fenêtre de 15 minutes (auth. utilisateur) | 500 |

<div id="parameters">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook_id (obligatoire) | Identifiant du webhook. Défini dans le chemin de la ressource. |

<div id="example-request">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

$ curl --request GET
--url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json
--header &#39;authorization: OAuth oauth_consumer_key=&quot;WHITELISTED_CONSUMER_KEY&quot;, oauth_nonce=&quot;GENERATED&quot;, oauth_signature=&quot;GENERATED&quot;, oauth_signature_method=&quot;HMAC-SHA1&quot;, oauth_timestamp=&quot;GENERATED&quot;, oauth_token=&quot;SUBSCRIBING_USER&#39;S_ACCESS_TOKEN&quot;, oauth_version=&quot;1.0&quot;&#39;

<div id="example-response-success">
  ### Exemple de réponse — Succès[](#example-response-success "Permalink to this headline")
</div>

*HTTP 204 SANS CONTENU*

```
    { }
```

<div id="get-account_activitywebhookswebhook_idsubscriptionsalllist">
  #### GET account_activity/webhooks/:webhook_id/subscriptions/all/list[](#get-account-activity-webhooks-webhook-id-subscriptions-all-list "Permalink to this headline")
</div>

Renvoie la liste des abonnements actuels de type All Activity pour le webhook spécifié. Notez que le point de terminaison /list requiert l’authentification OAuth en mode application uniquement ; les requêtes doivent donc être effectuées à l’aide d’un jeton Bearer plutôt qu’en contexte utilisateur.

<div id="resource-url">
  ### URL de la ressource[](#resource-url "Permalink to this headline")
</div>

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all/list.json`

<div id="resource-information">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | Code de réponse HTTP |
| Authentification requise | Oui (application uniquement — jeton Bearer) |
| Soumis à des limites de débit | Oui |
| Requêtes / fenêtre de 15 min (authentification applicative) | 50  |

<div id="parameters">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook_id (obligatoire) | Identifiant du webhook. Défini dans le chemin de ressource. |

### Codes de réponse HTTP[](#http-response-codes "Permalink to this headline")

| Code | Message |
| :--- | :--- |
| 200 | Réussite. Une liste des abonnements pour le webhook demandé sera renvoyée. |
| 401 | Votre application n’a pas l’autorisation d’afficher les abonnements pour le webhook spécifié. |

<div id="example-request">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

$ curl --request GET
--url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all/list.json
--header &#39;authorization: Bearer TOKEN&#39;

<div id="example-response-success">
  ### Exemple de réponse - Succès[](#example-response-success "Permalink to this headline")
</div>

*HTTP 200*

```bash
    {
      "webhook_id": "1234567890",
      "webhook_url": "https://your_domain.com/webhook/twitter/0",
      "application_id": "11231812",
      "subscriptions": [{
        "user_id": "20212306"
      }]
    }
```

### Messages d’erreur[](#error-messages "Lien permanent vers ce titre")

| Code | Message |
| :--- | :--- |
| 32  | Impossible de vous authentifier. |

*HTTP 401*

```bash
    {
      "errors": [
        {
           "code": 32,
          "message": "Could not authenticate you."
        }
      ]
    }
```

<div id="delete-account_activitywebhookswebhook_id">
  #### DELETE account_activity/webhooks/:webhook_id[](#delete-account-activity-webhooks-webhook-id "Permalink to this headline")
</div>

Supprime le webhook de la configuration de l’application spécifiée. L’ID du webhook peut être récupéré en effectuant un appel à GET /1.1/account_activity/webhooks.

<div id="resource-url">
  ### URL de la ressource[](#resource-url "Permalink to this headline")
</div>

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id.json`

<div id="resource-information">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de la réponse | JSON |
| Authentification requise | Oui (contexte utilisateur – tous les jetons consommateur et jetons d’accès) |
| Limitation du débit | Oui |
| Requêtes par fenêtre de 15 min (authentification utilisateur) | 15 |

<div id="parameters">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook_id (obligatoire) | Identifiant du webhook. Défini dans le chemin de la ressource. |

<div id="example-request">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID.json
     --header 'authorization: OAuth oauth_consumer_key="CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="ACCESS_TOKEN", oauth_version="1.0"'
```

<div id="response">
  ### Réponse[](#response "Permalink to this headline")
</div>

*HTTP 204 OK*

```
    { }
```

<div id="delete-account_activitywebhookswebhook_idsubscriptionsall-deprecated">
  #### DELETE account_activity/webhooks/:webhook_id/subscriptions/all (OBSOLÈTE)[](#delete-account-activity-webhooks-webhook-id-subscriptions-all-deprecated- "Permalink to this headline")
</div>

Désactive les abonnements pour le contexte utilisateur et l’application fournis. Après la désactivation, aucun événement concernant l’utilisateur ayant fait la requête ne sera plus envoyé à l’URL du webhook.

<div id="resource-url">
  ### URL de la ressource[](#resource-url "Permalink to this headline")
</div>

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/all.json`

<div id="resource-information">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (OAuth à 3 volets — clé consommateur autorisée et jeton d’accès de l’utilisateur abonné) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 min (auth. utilisateur) | 500 |

<div id="parameters">
  ### Paramètres[](#parameters "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| webhook_id (obligatoire) | Identifiant du webhook. Défini dans le chemin de ressource. |

### Exemple de requête[](#example-request "Lien permanent vers ce titre")

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:WEBHOOK_ID/subscriptions/all.json
     --header 'authorization: OAuth oauth_consumer_key="WHITELISTED_CONSUMER_KEY", oauth_nonce="GENERATED", oauth_signature="GENERATED", oauth_signature_method="HMAC-SHA1", oauth_timestamp="GENERATED", oauth_token="SUBSCRIBED_USER'S_ACCESS_TOKEN", oauth_version="1.0"'
```

Exemple de requête

```
    { }
```

<div id="delete-account_activitywebhookswebhook_idsubscriptionsuser_idalljson">
  #### DELETE /account_activity/webhooks/:webhook_id/subscriptions/:user_id/all.json[](#delete-account-activity-webhooks-webhook-id-subscriptions-user-id-all-json "Permalink to this headline")
</div>

Désactive l’abonnement pour le webhook et l’identifiant utilisateur spécifiés. Après la désactivation, tous les événements concernant l’utilisateur requérant ne seront plus envoyés à l’URL du webhook. Notez que ce point de terminaison nécessite OAuth en mode application uniquement ; les requêtes doivent donc être effectuées à l’aide d’un jeton d’accès (bearer) plutôt qu’avec un contexte utilisateur.

<div id="resource-url">
  ### URL de ressource[](#resource-url "Permalink to this headline")
</div>

`https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/:user_id/all.json`

<div id="resource-information">
  ### Informations sur la ressource[](#resource-information "Permalink to this headline")
</div>

|     |     |
| :--- | :--- |
| Format de réponse | JSON |
| Authentification requise | Oui (application uniquement — jeton d’authentification) |
| Limitation du débit | Oui |
| Requêtes / fenêtre de 15 min | 500 |

<div id="example-request">
  ### Exemple de requête[](#example-request "Permalink to this headline")
</div>

```bash
    $ curl --request DELETE
     --url https://api.x.com/1.1/account_activity/webhooks/:webhook_id/subscriptions/:user_id/all.json
     --header 'authorization: Bearer TOKEN'
```

### Réponse[](#response "Permalien vers ce titre")

*HTTP 204 AUCUN CONTENU*

<div id="error-messages">
  ### Messages d’erreur[](#error-messages "Permalink to this headline")
</div>

| Code | Message |
| :--- | :--- |
| 404 | Désolé, cette page n’existe pas. - Cela se produit souvent lorsque l’identifiant utilisateur indiqué n’est pas réellement abonné. |

<div id="replay-api">
  ### API de relecture
</div>

**POST /1.1/account_activity/replay/webhooks/:webhook_id/subscriptions/all.json [¶](#post-1-1-account-activity-replay-webhooks-webhook-id-subscriptions-all-json- "Permalink to this headline")**

Envoie une requête pour récupérer, sur une période maximale de cinq jours, les activités de toutes les souscriptions présentes pendant les fenêtres de dates et d’heures spécifiées. Si votre webhook a des souscriptions utilisateur actives, vous recevrez ces événements en parallèle. Remarque : un CRC est effectué avant la livraison des événements de relecture.

|     |     |
| :--- | :--- |
| **Méthode de requête** | HTTP POST |
| **URL** | /1.1/account_activity/replay/webhooks/:webhook_id/subscriptions/all.json?from_date=yyyymmddhhmm&amp;to_date=yyyymmddhhmm |
| **Format de réponse** | JSON |
| **Nécessite une authentification** | Oui (application uniquement — jeton Bearer) |
| **Limite de débit** | 5 requêtes par tranche de 15 minutes. Il n’y a actuellement aucune limite au nombre de tâches de relecture pouvant être demandées. |
| **from_date** | L’horodatage UTC le plus ancien (de départ) à partir duquel les événements seront fournis, au format « yyyymmddhhmm ». La granularité est à la minute et la borne est inclusive (p. ex. 12:00 inclut la minute 00). Les horaires valides doivent se situer dans les 5 derniers jours, en UTC, et ne pas être plus récents que 31 minutes avant l’instant présent. Il est recommandé que `from_date` et `to_date` couvrent ~2 heures au maximum. |
| **to_date** | L’horodatage UTC le plus récent (de fin) jusqu’auquel les événements seront fournis, au format « yyyymmddhhmm ». La granularité est à la minute et la borne est exclusive (p. ex. 12:30 n’inclut pas la 30e minute de l’heure). Les horaires valides doivent se situer dans les 5 derniers jours, en UTC, et ne pas être plus récents que 10 minutes avant l’instant présent. |

<div id="responses">
  #### Réponses
</div>

Les réponses suivantes peuvent être renvoyées par l’API. La plupart des codes d’erreur sont renvoyés avec une chaîne contenant des détails supplémentaires dans le corps. Pour les réponses non 200, vous devez corriger l’erreur puis réessayer.

| Statut | Texte | Code d’erreur | Description | Message |
| :--- | :--- | :--- | :--- | :--- |
| 202 | Acceptée | N/A | La requête a réussi et les activités seront envoyées. | N/A |
| 400 | Requête incorrecte | 214 | Le webhook a été marqué comme invalide. | Le webhook est marqué comme invalide et nécessite une vérification CRC. |
| 400 | Requête incorrecte | 357 | Paramètre de requête manquant. | : queryParam est requis. |
| 400 | Requête incorrecte | 358 | Le paramètre d’itinéraire ou de requête est mal formé. | Impossible d’analyser le paramètre. |
| 400 | Requête incorrecte | 360 | Le paramètre d’itinéraire est négatif. | webhook_id: [] n’est pas supérieur ou égal à 0. |
| 400 | Requête incorrecte | 368 | from_date ou to_date n’est pas dans le passé. | : [&lt;field_value&gt;] n’est pas dans le passé. |
| 400 | Requête incorrecte | 356 | from_date doit être antérieur à to_date. | from_date doit être antérieur à to_date. |
| 400 | Requête incorrecte | 356 | from_date doit être dans les 5 derniers jours. | from_date doit être dans les 5 derniers jours. |
| 401 | Non autorisé | 32  | Échec de l’authentification HTTP en raison d’une authentification à 3 facteurs fournie. | Méthode d’authentification invalide. Veuillez utiliser l’authentification application-only. |
| 401 | Non autorisé | 61  | Le client n’est pas autorisé à demander cette méthode. | Le client n’est pas autorisé à demander cette méthode. |
| 403 | Interdit | 200 | Le client n’a pas de compte Enterprise avec la fonctionnalité Replay activée. | Un compte Enterprise de l’Account Activity API avec Replay est requis. Veuillez confirmer que vous avez un compte Enterprise et que Replay est activé. |
| 404 | Introuvable | 34  | webhook_id inexistant ; discordance webhook_id-application_id. | Le webhook n’existe pas ou est associé à une autre application X. |
| 409 | Conflit | 355 | Une requête est en cours et doit se terminer avant d’en lancer une autre. | Une tâche de replay est déjà en cours pour ce webhook. |
| 429 | Trop de requêtes | 88  | Limitation de débit (nombre de requêtes par période dépassé) | Trop de requêtes. Veuillez réduire le taux de vos requêtes API. |
| 500 | Erreur interne du serveur | 0   | Erreur interne du serveur. | Erreur interne du serveur. |
| 503 | Service indisponible | 67  | Un ou plusieurs services dépendants chez X sont indisponibles. | Erreur du serveur X. Réessayez en utilisant une stratégie d’attente exponentielle (exponential backoff). |

<div id="job-completed-successfully-message">
  #### Message « Tâche terminée avec succès »
</div>

Une fois votre tâche terminée avec succès, l’API Account Activity Replay enverra l’événement de fin de tâche suivant. Dès réception de cet événement, la tâche a fini de s’exécuter et vous pouvez en soumettre une autre.

```json
{
  "replay\_job\_status": {
    "webhook_id": "1234577122340233217",
    "job_state": "Complete",
    "job\_state\_description": "Job completed successfully"
    "job_id": "1095098195724558337"
  }
}
```

<div id="job-failed-to-complete-message">
  #### Message « Échec de l’exécution du job »
</div>

Si votre job ne se termine pas correctement, nous renverrons le message suivant vous invitant à réessayer votre job Replay. Une fois que vous recevez cet événement, le job a terminé son exécution et vous pouvez en soumettre un autre.

```json
{
  "replay\_job\_status": {
    "webhook_id": "123451374207332352",
    "job_state": "Incomplete",
    "job\_state\_description": "Job failed to deliver all events, please retry your replay job",
    "job_id": "1093226942650736640"
  }
}
```

<div id="example-curl-request">
  #### Exemple de requête curl
</div>

```bash
    curl --request POST  --url 'https://api.x.com/1.1/account_activity/replay/webhooks/:webhook_id/subscriptions/all.json?from_date=yyyymmddhhmm&to_date=yyyymmddhhmm'
    --header 'authorization: Bearer TOKEN'
```

<div id="example-response">
  #### Exemple de réponse
</div>

HTTP 202

```bash
{
  "job_id": "1234567890",
  "created_at": "2016-06-02T23:54:02Z"
}
```