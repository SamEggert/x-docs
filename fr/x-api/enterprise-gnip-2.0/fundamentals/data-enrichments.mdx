---
title: "Enrichissement des données : Entreprise"
---

<div id="introduction">
  ## Introduction
</div>

`Enterprise`

Les enrichissements Enterprise sont des métadonnées additionnelles incluses dans la charge utile de réponse de certaines API de données. Ils sont disponibles uniquement avec des offres d’abonnement payantes.

Le tableau ci-dessous propose une brève description de chaque enrichissement :

| Enrichment: | Description: |
| :--- | :--- |
| Expanded and Enhanced URLs | Développe automatiquement les URL raccourcies (p. ex., Bitly) incluses dans le corps d’un Post et fournit les métadonnées Title et Description HTML de la page de destination. |
| Matching rules object | Indique quelle(s) règle(s) a/ont été appliquée(s) aux Posts reçus. L’objet renvoie le tag et l’ID de la règle dans l’objet de réponse. |
| Poll metadata | Signale la présence d’un sondage dans un Post, inclut la liste des options du sondage ainsi que sa durée et son heure d’expiration. |
| Profile geo | Données de localisation de profil utilisateur dérivées, y compris les coordonnées [longitude, latitude] (lorsque c’est possible) et les métadonnées de lieu associées. |

<div id="expanded-and-enhanced-urls">
  ### URL développées et enrichies
</div>

L’enrichissement « URL développées et enrichies » déplie automatiquement les URL raccourcies présentes dans le corps d’un Post et ajoute l’URL finale comme métadonnée au sein de la charge utile. En outre, cet enrichissement fournit aussi les métadonnées de la page HTML à partir des balises `title` et `description` de la page de destination.

**Détails importants :**

* Pour résoudre un lien raccourci, notre système envoie des requêtes HTTP HEAD à l’URL fournie et suit toutes les redirections jusqu’à l’URL finale. Cette URL finale (ET NON le contenu de la page lui‑même) est ensuite incluse dans la charge utile de la réponse.

* L’enrichissement d’URL ajoute entre 5 et 10 secondes de latence aux flux en temps réel

* Pour les requêtes adressées à la Full Archive Search API, les données d’enrichissement des URL développées ne sont disponibles que pour les Posts de 13 mois ou moins.

* L’enrichissement d’URL n’est pas disponible pour les liens de Post (y compris les Tweets cités), les liens Moments et les liens de profil inclus dans un Post. 
   

<div id="post-payload">
  #### Charge utile du Post
</div>

L’enrichissement d’URL développée et étendue se trouve dans l’objet `entities` de la charge utile du Post — plus précisément dans l’objet `entities.urls.unwound`. Il fournit les champs de métadonnées suivants :

* URL développée — `unwound.url`
* Statut HTTP de l’URL développée — `unwound.status`
* Titre HTML de l’URL développée — limite de 300 caractères — `unwound.title`
* Description HTML de l’URL développée — limite de 1000 caractères — `unwound.description`

**Voici un exemple d’un [objet entities](/fr/x-api/enterprise-gnip-2.0/fundamentals/data-dictionary#x-entities) avec l’enrichissement d’URL :**

```
"entities": {
    "hashtags": [

    ],
    "urls": [
      {
        "url": "https:\/\/t.co\/HkTkwFq8UT",
        "expanded_url": "http:\/\/bit.ly\/2wYTb9y",
        "display_url": "bit.ly\/2wYTb9y",
        "unwound": {
          "url": "https:\/\/www.forbes.com\/sites\/laurencebradford\/2016\/12\/08\/11-websites-to-learn-to-code-for-free-in-2017\/",
          "status": 200,
          "title": "11 Websites To Learn To Code For Free In 2017",
          "description": "It\u2019s totally possible to learn to code for free...but what are the best resources to achieve that? Here are 11 websites where you can get started."
        },
        "indices": [
          10,
          33
        ]
      }
    ],
    "user_mentions": [

    ],
    "symbols": [

    ]
  },
```

**Voici un exemple d’un objet entities contenant un lien de Post qui n’est pas enrichi :**

```
"entities": {
  "urls": [{
    "url": "https://t.co/SywNbZdDmb",
    "expanded_url": "https://x.com/XDevelopers/status/1050118621198921728",
    "display_url": "x.com/XDevelopers/s…",
     "indices": [
        142,
        165
     ]
   }
  ]
}
```

<div id="filtering-operators">
  #### Opérateurs de filtrage
</div>

Les opérateurs suivants filtrent et effectuent une correspondance tokenisée sur les champs associés des métadonnées d’URL :

**url :**

* Exemple : « url:tennis »
* Correspondance tokenisée sur toute URL développée contenant le mot tennis
* Peut également servir de filtre pour inclure ou exclure des liens d’un site web spécifique, par exemple « url:npr.org »

**url&#95;title :**

* Exemple : « url&#95;title:tennis »
* Correspondance tokenisée sur tout titre HTML d’URL développée contenant le mot tennis
* Correspond aux données de titre HTML incluses dans le payload, limitées à 300 caractères.

**url&#95;description :**

* Exemple : « url&#95;description:tennis »
* Correspondance tokenisée sur toute description HTML d’URL développée contenant le mot tennis
* Correspond à la description HTML incluse dans le payload, limitée à 1000 caractères.
   

<div id="http-status-codes">
  #### Codes d’état HTTP
</div>

L’enrichissement d’URL développée fournit également le code d’état HTTP pour l’URL finale que nous tentons de dérouler. Dans les cas normaux, il s’agit d’une valeur 200. D’autres valeurs de la série 400 indiquent des problèmes de résolution de l’URL.

Divers codes d’état peuvent être renvoyés lors de la tentative de dérouler une URL. Au cours du processus de déroulement d’une URL, si nous rencontrons une redirection, nous la suivrons indéfiniment jusqu’à ce que nous :

* Atteignions un code de la série 200 (succès)
* Atteignions un code d’une série autre que redirection (échec)
* Arrivions à un délai dépassé parce que l’URL finale n’a pas pu être résolue dans un délai raisonnable (renvoie un 408 — délai dépassé)
* Rencontrions une exception quelconque
   

Si une exception se produit, nous utilisons la correspondance suivante entre les raisons et les codes d’état renvoyés :

| Raison | Code d’état renvoyé |
| :--- | :--- |
| Exceptions SSL | 403 (Interdit) |
| Déroulement non autorisé par l’URL | 405 |
| Délai de socket dépassé | 408 (Délai dépassé) |
| Exception d’hôte inconnu | 404 (Introuvable) |
| Opération non prise en charge | 404 (Introuvable) |
| Exception de connexion | 404 (Introuvable) |
| Argument non valide | 400 (Mauvaise requête) |
| Tout le reste | 400 (Mauvaise requête) |

<div id="matching-rules">
  ### Règles de correspondance
</div>

L’enrichissement « matching rules » est un objet de métadonnées qui indique quelle(s) règle(s) a(ont) permis de faire correspondre les Posts reçus. Il est le plus souvent utilisé avec le flux PowerTrack.

La correspondance est effectuée par appariement exact des termes contenus dans une règle, en analysant le contenu de l’activité avec et sans ponctuation. La correspondance n’est pas sensible à la casse. Lorsque le contenu contient tous les termes définis dans la règle, un objet `matching_rules` est présent au niveau racine, indiquant la ou les règles à l’origine de la correspondance.

**PowerTrack**

Les Posts livrés via PowerTrack (temps réel, Replay et Historique) contiendront l’objet `matching_rules` comme suit :

```
"matching_rules": [{
        "tag": null,
        "id": 907728589029646336,
        "id_str": "907728589029646336"
    }]
```

Dans PowerTrack, l’objet `matching_rules` reflète *toutes* les règles qui ont fait correspondre le résultat donné. En d’autres termes, si plusieurs règles correspondent à un Post spécifique, celui-ci ne sera livré qu’une seule fois, mais l’élément `matching_rules` contiendra toutes les règles correspondantes.

<div id="poll-metadata">
  ### Métadonnées de sondage
</div>

Les métadonnées de sondage sont un enrichissement gratuit disponible dans tous les produits (API en temps réel et historiques) dans des charges utiles enrichies au format natif. Elles signalent la présence d’un sondage dans une publication, incluent la liste des choix du sondage, ainsi que la durée du sondage et son heure d’expiration. Cet enrichissement facilite l’identification de la présence d’un sondage et permet l’affichage correct d’une publication contenant un sondage.

<div id="important-details">
  ##### Détails importants :
</div>

* Disponible sur toutes les API Enterprise (PowerTrack, Replay, Search, Historical PowerTrack)
  * *Remarque :* Pour Replay et Historical PowerTrack, ces métadonnées ont été proposées pour la première fois le 22/02/17.
* N’inclut pas les informations de vote ni les résultats de sondage
* Ne prend actuellement pas en charge les filtres/opérateurs
* Disponible uniquement au format **natif enrichi**
  * Le format natif enrichi est un paramètre contrôlé par l’utilisateur qui peut être modifié à tout moment via la Console : *Select a Product (PowerTrack, Replay, Search) &gt; Settings tab &gt; Output Format (Leave data in its original format)*

<div id="post-payload">
  #### Charge utile de publication
</div>

Une publication de sondage contiendra les métadonnées suivantes dans l’objet « entities.polls » de la charge utile :

* Un tableau « options » comportant jusqu’à quatre options indiquant la position (1 à 4) et le libellé de l’option
* Date d’expiration du sondage
* Durée du sondage

Voir l’exemple de charge utile ci-dessous pour plus de détails.

<div id="sample-payload">
  #### Exemple de charge utile
</div>

Ci-dessous, un extrait de la charge utile au format natif enrichi, mettant en évidence les métadonnées de sondage ajoutées :

```json
"entities":{
          "hashtags":[],
          "urls":[],
          "user_mentions":[],
          "symbols":[],
          "polls":[
             {
                "options":[
                   {
                      "position":1,
                      "text":"La meilleure réponse"
                   },
                   {
                      "position":2,
                      "text":"La réponse optimale"
                   }
                ],
                "end_datetime":"Sat Feb 04 15:33:11 +0000 2017",
                "duration_minutes":1440
             }
          ]
       },
```

<div id="profile-geo">
  ### Géolocalisation du profil
</div>

<div id="introduction">
  #### Introduction
</div>

De nombreux profils d’utilisateurs X incluent des informations de localisation publiques fournies par l’utilisateur. Ces données sont renvoyées sous forme de chaîne de caractères dans user.location (voir [Dictionnaire de données de l’objet User](/fr/x-api/enterprise-gnip-2.0/fundamentals/data-dictionary#native-enriched-user-object)). L’enrichissement Profile Geo ajoute des géodonnées structurées pertinentes pour la valeur de user.location en géocodant et en normalisant les chaînes de localisation lorsque cela est possible. Les coordonnées de latitude/longitude et les métadonnées de lieu associées sont ajoutées à user.derived.locations uniquement lorsqu’elles sont incluses dans la charge utile du Post dans les produits d’API Enterprise. Ces données sont disponibles lors de l’utilisation du [format natif enrichi](/fr/x-api/enterprise-gnip-2.0/fundamentals/data-dictionary) et peuvent être filtrées à l’aide d’une combinaison de [règles PowerTrack](/fr/x-api/enterprise-gnip-2.0/fundamentals/rules-filtering#enterprise-operators).

<Note>
  **Remarque :** Certaines des géodonnées utilisées pour créer l’enrichissement Profile Geo proviennent de GeoNames.org et sont utilisées par X sous la [licence Creative Commons Attribution 3.0](https://creativecommons.org/licenses/by/3.0/us/legalcode).
</Note>

Les données Profile Geo seront incluses dans les API PowerTrack, Replay, Volume Stream, Search et Historical PowerTrack de X.

<div id="profile-geo-data">
  #### Données géographiques du profil
</div>

| Nom du champ natif enrichi | Valeur d’exemple | Description |
| :--- | :--- | :--- |
| user.derived.locations.country | United States | Le pays d’origine de l’utilisateur qui a créé la publication. |
| user.derived.locations.country&#95;code | US  | Un code pays ISO 3166 à deux lettres correspondant au pays d’origine de l’utilisateur qui a créé la publication. |
| user.derived.locations.locality | Birmingham | La localité (généralement la ville) d’origine de l’utilisateur qui a créé la publication. |
| user.derived.locations.region | Alabama | La région (généralement l’État/la province) d’origine de l’utilisateur qui a créé la publication. |
| user.derived.locations.sub&#95;region | Jefferson County | La sous-région (généralement le comté) d’origine de l’utilisateur qui a créé la publication. |
| user.derived.locations.full&#95;name | Birmingham, Alabama, United States | Le nom complet (hors sous-région) du lieu d’origine de l’utilisateur qui a créé la publication. |
| user.derived.locations.geo | See Below | Un tableau contenant une valeur lat/long pour une coordonnée correspondant au niveau de granularité le plus fin du lieu d’origine de l’utilisateur qui a créé la publication. |

Les API Historical PowerTrack, Search et PowerTrack prennent en charge le filtrage basé sur les données géographiques de profil. Consultez la documentation produit appropriée pour plus de détails sur les opérateurs disponibles pour filtrer les données géographiques de profil.

<div id="sample-payload">
  #### Exemple de charge utile
</div>

```
{
    "user": {
        "derived": {
            "locations": \[
                {
                    "country": "United States",
                    "country_code": "US",
                    "locality": "Birmingham",
                    "region": "Alabama",
                    "sub_region": "Jefferson County",
                    "full_name": "Birmingham, Alabama, United States",
                    "geo": {
                        "coordinates": \[
                            -86.80249,
                            33.52066
                        \],
                        "type": "point"
                    }
                }
            \]
        }
    }
}
```

<div id="limitations">
  #### Limitations
</div>

* L’enrichissement Profile Geo tente d’identifier le lieu géographique le plus pertinent à partir de la chaîne de localisation du profil. Le résultat peut ne pas être exact dans tous les cas en raison de facteurs tels que l’existence de plusieurs lieux aux noms similaires ou de noms ambigus.
* Si aucune valeur n’est fournie dans le champ de localisation du profil de l’utilisateur (actor.location), nous n’essaierons pas d’effectuer de classification.
* Niveau de précision : si un enrichissement Profile Geo ne peut être établi avec confiance qu’au niveau du pays ou de la région, les géographies de niveau inférieur telles que subRegion et locality seront omises de la charge utile.
* L’enrichissement Profile Geo fournit des coordonnées lat/long (un point unique) qui correspondent au niveau de précision des résultats. Ces coordonnées représentent le centre géographique du lieu retourné par l’enrichissement. Par exemple, si le niveau de précision est le niveau Pays, ces coordonnées sont définies sur le centre géographique de ce pays.
* Les opérateurs PowerTrack fournis pour les propriétés d’adresse (locality/region/country/country code) sont volontairement granulaires afin de permettre de nombreuses combinaisons de règles. Lorsqu’il s’agit de cibler un lieu spécifique partageant un nom avec un autre, pensez à combiner des règles d’adresse. Par exemple, ce qui suit évitera les correspondances pour « San Francisco, Philippines » : profile&#95;locality:&quot;San Francisco&quot; profile&#95;region:California. Lors de la création de règles ciblant des champs Profile Geo individuels, gardez à l’esprit que chaque niveau de granularité supplémentaire restreindra les résultats. Dans certains cas, lorsque vous cherchez à analyser des données d’une ville, vous pouvez choisir de ne vous appuyer que sur une règle de région lorsque celle-ci recouvre largement la ville ; par exemple, la ville de Zurich, en Suisse, peut être efficacement ciblée, ainsi que ses environs, avec profile&#95;region:&quot;Zurich&quot;.
* Utilisation avec les posts Geo natifs : l’enrichissement Profile Geo fournit un type de géographie alternatif pour un post, différent de la valeur geo native dans la charge utile. Ces deux types de géographie peuvent être combinés pour capturer l’ensemble des posts possibles liés à une zone donnée (en fonction des géodonnées disponibles), bien qu’ils ne soient pas conceptuellement équivalents.