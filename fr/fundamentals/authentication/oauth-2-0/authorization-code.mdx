---
title: Flux de code d’autorisation OAuth 2.0 avec PKCE
sidebarTitle: Flux de code d’autorisation OAuth 2.0 avec PKCE
---

<div id="oauth-20-authorization-code-flow-with-pkce">
  ### Flux d’autorisation OAuth 2.0 avec code et PKCE
</div>

<div id="introduction">
  #### Introduction
</div>

OAuth 2.0 est un protocole d’autorisation standard du secteur qui offre un meilleur contrôle du périmètre d’une application et des parcours d’autorisation sur plusieurs appareils. OAuth 2.0 vous permet de sélectionner des périmètres fins et spécifiques qui vous accordent des permissions précises au nom d’un utilisateur.

Pour activer OAuth 2.0 dans votre application, vous devez l’activer dans les paramètres d’authentification de votre application, disponibles dans la section Paramètres de l’application du portail développeurs.

#### Pendant combien de temps mes identifiants resteront-ils valides ?  

Par défaut, le jeton d’accès que vous créez via le flux Authorization Code avec PKCE n’est valide que pendant deux heures, sauf si vous avez utilisé le scope `offline.access`.

<div id="refresh-tokens">
  #### Jetons d’actualisation
</div>

Les jetons d’actualisation permettent à une application d’obtenir un nouveau jeton d’accès sans solliciter l’utilisateur, via le flux d’actualisation.

Si la portée `offline.access` est appliquée, un jeton d’actualisation OAuth 2.0 est émis. Avec ce jeton d’actualisation, vous pouvez obtenir un jeton d’accès. Si cette portée n’est pas fournie, aucun jeton d’actualisation ne sera généré.

Voici un exemple de requête permettant d’utiliser un jeton d’actualisation pour obtenir un nouveau jeton d’accès :

```bash
POST 'https://api.x.com/2/oauth2/token' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'refresh_token=bWRWa3gzdnk3WHRGU1o0bmRRcTJ5VUxWX1lZTDdJSUtmaWcxbTVxdEFXcW5tOjE2MjIxNDc3NDM5MTQ6MToxOnJ0OjE' \
--data-urlencode 'grant_type=refresh_token' \
--data-urlencode 'client_id=rG9n6402A3dbUJKzXTNX4oWHJ
```

<div id="app-settings">
  #### Paramètres de l’application
</div>

Vous pouvez définir l’authentification de votre application sur OAuth 1.0a ou OAuth 2.0. Vous pouvez également autoriser une application à utiliser à la fois OAuth 1.0a et OAuth 2.0.

OAuth 2.0 ne peut être utilisé qu’avec l’API X v2. Si vous avez choisi OAuth 2.0, vous verrez un Client ID dans la section Keys and Tokens de votre application. 

<div id="confidential-clients">
  #### Clients confidentiels
</div>

Les [clients confidentiels](https://datatracker.ietf.org/doc/html/rfc6749#section-2.1) peuvent conserver des identifiants de manière sûre sans les exposer à des tiers non autorisés et s’authentifier de façon sécurisée auprès du serveur d’autorisation, ce qui permet de protéger votre secret client. Les clients publics, exécutés généralement dans un navigateur ou sur un appareil mobile, ne peuvent pas utiliser vos secrets client. Si vous sélectionnez un type d’application qui est un client confidentiel, un secret client vous sera fourni.

Si vous avez sélectionné dans le portail développeur un type de client confidentiel, vous verrez également un secret client. Vos options sont Native App, Single Page App, Web App, Automated App ou bot. Les Native Apps et Single Page Apps sont des clients publics, tandis que les Web Apps et les Automated Apps ou bots sont des clients confidentiels.

Vous n’avez pas besoin d’un client_id pour les clients confidentiels si l’en-tête Authorization est valide. Vous devez en revanche inclure client_id dans le corps des requêtes avec un client public. 

<div id="scopes">
  #### Scopes
</div>

Les scopes vous permettent de définir un accès granulaire pour votre application afin qu’elle ne dispose que des autorisations nécessaires. Pour en savoir plus sur la correspondance entre les scopes et les endpoints, consultez notre [guide de correspondance d’authentification](/fr/resources/fundamentals/authentication/guides/v2-authentication-mapping).

|     |     |
| :--- | :--- |
| **Scope** | **Description** |
| tweet.read | Tous les Tweets que vous pouvez voir, y compris ceux provenant de comptes protégés. |
| tweet.write | Publier des Tweets et des Retweets en votre nom. |
| tweet.moderate.write | Masquer et réafficher les réponses à vos Tweets. |
| users.email | Adresse e-mail d’un utilisateur authentifié. |
| users.read | Tout compte que vous pouvez voir, y compris les comptes protégés. |
| follows.read | Les personnes qui vous suivent et celles que vous suivez. |
| follows.write | Suivre et ne plus suivre des personnes en votre nom. |
| offline.access | Rester connecté à votre compte jusqu’à révocation de l’accès. |
| space.read | Tous les Spaces que vous pouvez voir. |
| mute.read | Comptes que vous avez mis en sourdine. |
| mute.write | Mettre en sourdine et réactiver des comptes en votre nom. |
| like.read | Tweets que vous avez aimés et mentions J’aime que vous pouvez voir. |
| like.write | Aimer et ne plus aimer des Tweets en votre nom. |
| list.read | Listes, membres de listes et abonnés des listes que vous avez créées ou dont vous êtes membre, y compris les listes privées. |
| list.write | Créer et gérer des listes en votre nom. |
| block.read | Comptes que vous avez bloqués. |
| block.write | Bloquer et débloquer des comptes en votre nom. |
| bookmark.read | Récupérer les Tweets ajoutés aux signets par un utilisateur authentifié. |
| bookmark.write | Ajouter des signets à des Tweets et en supprimer. |
| media.write | Importer des médias. |

<div id="rate-limits">
  #### Limites de débit
</div>

Dans l’ensemble, les limites de débit sont les mêmes qu’avec l’authentification OAuth 1.0a, à l’exception de la consultation de Tweets et de la consultation d’utilisateurs. Nous portons la limite par application de 300 à 900 requêtes par tranche de 15 minutes lors de l’utilisation d’OAuth 2.0 pour la consultation de Tweets et d’utilisateurs. Pour en savoir plus, consultez notre [documentation sur les limites de débit](/fr/resources/fundamentals/rate-limits).

<div id="grant-types">
  #### Types de flux
</div>

Pour ce lancement initial, nous ne prenons en charge que le [code d’autorisation](https://oauth.net/2/grant-types/authorization-code/) avec [PKCE](https://oauth.net/2/pkce/) et le [jeton d’actualisation](https://oauth.net/2/grant-types/refresh-token/) comme [types de flux](https://oauth.net/2/grant-types/). D’autres types de flux pourront être proposés à l’avenir.

<div id="oauth-20-flow">
  #### Parcours OAuth 2.0
</div>

OAuth 2.0 suit un parcours similaire à celui que nous utilisons actuellement pour OAuth 1.0a. Vous pouvez consulter un diagramme et une explication détaillée dans notre [documentation à ce sujet](/fr/resources/fundamentals/authentication/oauth-1-0a/obtaining-user-access-tokens). 

<div id="glossary">
  #### Glossaire
</div>

|     |     |
| :--- | :--- |
| **Terme** | **Description** |
| Types de grant | Le cadre OAuth définit plusieurs types de grant pour différents cas d’usage ainsi qu’un mécanisme pour en créer de nouveaux. Exemples : authorization code, client credentials, device code et refresh token. |
| Client confidentiel | Applications pouvant s’authentifier de façon sécurisée auprès du serveur d’autorisation, par exemple en conservant leur client secret enregistré en lieu sûr. |
| Client public | Applications qui ne peuvent pas utiliser de client secrets enregistrés, comme celles s’exécutant dans un navigateur ou sur un appareil mobile. |
| Authorization code flow | Utilisé par les clients confidentiels et publics pour échanger un authorization code contre un access token. |
| PKCE | Extension de l’authorization code flow destinée à prévenir plusieurs attaques et à permettre d’effectuer l’échange OAuth de manière sécurisée depuis des clients publics. |
| Client ID | Disponible dans la section keys and tokens du developer portal, sous l’en-tête « Client ID ». Si vous ne le voyez pas, veuillez contacter directement notre équipe. Le Client ID est nécessaire pour générer l’authorize URL. |
| Redirect URI | Votre callback URL. Vous devez avoir une [validation de correspondance exacte](https://datatracker.ietf.org/doc/html/rfc6749#section-10.6). |
| Authorization code | Permet à une application d’appeler des API au nom d’utilisateurs. Appelé auth_code. L’auth_code a une durée de validité de 30 secondes dès que le propriétaire de l’App reçoit un auth_code approuvé par l’utilisateur. Vous devez l’échanger contre un access token dans les 30 secondes, sinon l’auth_code expirera. |
| Access token | Les access tokens sont les jetons que les applications utilisent pour effectuer des requêtes API au nom d’un utilisateur. |
| Refresh token | Permet à une application d’obtenir un nouvel access token sans solliciter l’utilisateur, via le refresh token flow. |
| Client Secret | Si vous avez sélectionné un type d’App de type client confidentiel, un « Client Secret » vous sera fourni sous « Client ID » dans la section keys and tokens de votre App. |

<div id="parameters">
  #### Paramètres
</div>

Pour construire une URL d’autorisation OAuth 2.0, assurez-vous d’inclure les paramètres suivants dans l’URL. 

|     |     |
| :--- | :--- |
| **Paramètre** | **Description** |
| response_type | Indiquez que vous demandez un code en utilisant le mot « code ». |
| client_id | Disponible dans le portail développeur sous l’intitulé « Client ID ». |
| redirect_uri | Votre URL de redirection (callback). Cette valeur doit correspondre exactement à l’une des URL de redirection définies dans les paramètres de votre application. Pour OAuth 2.0, vous devez appliquer une [validation de correspondance exacte](https://datatracker.ietf.org/doc/html/rfc6749#section-10.6) pour votre URL de redirection. |
| state | Une chaîne aléatoire que vous fournissez pour vous protéger contre les [attaques CSRF](https://auth0.com/docs/protocols/state-parameters). La longueur de cette chaîne peut atteindre 500 caractères. |
| code_challenge | Un paramètre [PKCE](https://www.oauth.com/oauth2-servers/pkce/authorization-request/), un secret aléatoire propre à chaque requête. |
| code_challenge_method | Spécifie la méthode utilisée pour la requête (S256 ou plain). |

#### URL d’autorisation 

Avec OAuth 2.0, vous créez une URL d’autorisation que vous pouvez utiliser pour permettre à un utilisateur de s’authentifier via un flux d’authentification, similaire à « Se connecter avec X ». 

Voici un exemple de l’URL que vous créez : 

```
https://x.com/i/oauth2/authorize?response_type=code&client_id=M1M5R3BMVy13QmpScXkzTUt5OE46MTpjaQ&redirect_uri=https://www.example.com&scope=tweet.read%20users.read%20account.follows.read%20account.follows.write&state=state&code_challenge=challenge&code_challenge_method=plain
```

Vous devrez appliquer l’encodage approprié pour que cette URL fonctionne ; consultez notre documentation sur l’[encodage pourcentage](/fr/resources/fundamentals/authentication/oauth-1-0a/percent-encoding-parameters).